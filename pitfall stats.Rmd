---
title: "pitfall invert stats"
author: "Colleen"
date: "1/7/2022"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load data}
pitfall=read.csv("C:/Users/crc31/dropbox/Jennings Invertebrates/Cosgrove pitfall inverts_comb.csv", header=T)
dim(pitfall)
soildata=read.csv("C:/Users/crc31/OneDrive/Documents/School/Grad School/SpatialStats/soil data May 08 for tree plots.csv")
treedata=read.csv("C:/Users/crc31/Dropbox/Jennings 2016/New Adult Basal Area.csv")
#fiddle with the tree data
treedata[is.na(treedata)] <- 0
treedata=treedata[treedata$ecosys!="S",] #Remove the stream plots -- Will need to put these back in when I fix the commdata$ecosystem columns.
tree.ringsum=treedata[1:83,]
for(i in 1:83) {
	tree.ringsum[i,10:42]=treedata[i,10:42]+treedata[i+83,10:42]+treedata[i+166,10:42]  }
rownames(tree.ringsum)=tree.ringsum[,1]
# Let's look at a rank abbundance plot for fun
tree.colsums=apply(tree.ringsum[,10:42],2,sum)
plot(rank(tree.colsums),tree.colsums, xlab="tree species")

# Perform Hellinger transformation on tree species data so that RDA is based on Hellinger distance
tree.rowsums=apply(tree.ringsum[,10:42],1,sum)
tree.hel=tree.ringsum
tree.hel[,10:42]=tree.hel[,10:42]/tree.rowsums
tree.hel[,10:42]=sqrt(tree.hel[,10:42])

#change NAs in the count columns to 0s.
pitfall[is.na(pitfall)]<-0

##the column "kick" is designed to remove rows that are mis-labeled or duplicate samples. e.g., like 3 Q1 from the same date. Let's remove those.
pitfall=subset(pitfall, kick=="no")

##lets add in the data for soil, which will also add in the habitat type information.
names(pitfall)[names(pitfall)=='Ã¯..Site']<-'Plot'
pitfall=merge(pitfall, soildata, by="Plot")
pitfall=merge(pitfall,tree.hel, by="Plot")

###Subset data
date1=pitfall[pitfall$Sample.pd=="Date 1",]
date2=pitfall[pitfall$Sample.pd=="Date 2",]
date3=pitfall[pitfall$Sample.pd=="Date 3",]
date4=pitfall[pitfall$Sample.pd=="Date 4",]

#load libraries
library(vegan)
```

Decoupling Stats - Community-wide
```{r RDA Date 1}
#remove NAs.
date1=na.omit(date1)
#save a back-up for later, just in case.
date1.2=date1
##rda by soil
hel.rda.fulsoil = rda(date1[,5:205], date1[,215:239])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(date1[,5:205],date1[,c(248:282)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(date1)
all.geog.dist=vegdist(date1[,246:247],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(date1,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(date1,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:205], tree.hel.all.pcnm[,284:326])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning not needed because no significance.

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(date1[,5:205]~date1$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
date1=date1.2[date1.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(date1[,5:205], date1[,215:239])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(date1[,5:205],date1[,c(248:282)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

###Pitter patter, let's get atter. Let's do that sweet sweet forward selection
##Forward selection
hel.rda.fulsoil.none = rda(date1[,5:205]~1)
hel.rda.fulsoil = rda(date1[,5:205], date1[,248:282])

hel.rda.fulsoil.full=rda(date1[,5:205]~date1$ACERUB+date1$ACESAC+date1$ACESIL+date1$BETALL+date1$CARCAR+date1$CARCOR+date1$CARTOM+date1$CORFLO+date1$CRAPUN+date1$FAGAME+date1$FRAAME+date1$FRANIG+date1$HAMVIR+date1$LIRTUP+date1$MAGACU+date1$MALCOR+date1$NYSSYL+date1$OSTVIR+date1$PLAOCC+date1$POPDEL+date1$POPGRA+date1$PRUSER+date1$QUEALB+date1$QUEBIC+date1$QUEPAL+date1$QUERUB+date1$SALNIG+date1$SASALB+date1$TILAME+date1$TOXVER+date1$ULMAME+date1$ULMRUB+date1$ULMSP+date1$VIBLEN)

tree.sel=ordiR2step(hel.rda.fulsoil.none,scope=formula(hel.rda.fulsoil.full),Pin=0.05,R2scope=TRUE)
tree.sel

##Just the variables forward selected
hel.rda.fulsoil = rda(date1[,5:205], date1[,c(248:282)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(date1)
all.geog.dist=vegdist(date1[,246:247],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(date1,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(date1,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:205], tree.hel.all.pcnm[,284:307])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

###Pitter patter, let's get atter. Let's do that sweet sweet forward selection
##Forward selection
hel.rda.fulsoil.none = rda(tree.hel.all.pcnm[,5:205]~1)
hel.rda.fulsoil = rda(tree.hel.all.pcnm[,5:205], tree.hel.all.pcnm[,284:307])

hel.rda.fulsoil.full=rda(tree.hel.all.pcnm[,5:205]~tree.hel.all.pcnm$PCNM1+tree.hel.all.pcnm$PCNM2+tree.hel.all.pcnm$PCNM3+tree.hel.all.pcnm$PCNM4+tree.hel.all.pcnm$PCNM5+tree.hel.all.pcnm$PCNM6+tree.hel.all.pcnm$PCNM7+tree.hel.all.pcnm$PCNM8+tree.hel.all.pcnm$PCNM9+tree.hel.all.pcnm$PCNM10+tree.hel.all.pcnm$PCNM11+tree.hel.all.pcnm$PCNM12+tree.hel.all.pcnm$PCNM13+tree.hel.all.pcnm$PCNM14+tree.hel.all.pcnm$PCNM15+tree.hel.all.pcnm$PCNM16+tree.hel.all.pcnm$PCNM17+tree.hel.all.pcnm$PCNM18+tree.hel.all.pcnm$PCNM19+tree.hel.all.pcnm$PCNM20+tree.hel.all.pcnm$PCNM21+tree.hel.all.pcnm$PCNM22+tree.hel.all.pcnm$PCNM23+tree.hel.all.pcnm$PCNM24)

tree.sel=ordiR2step(hel.rda.fulsoil.none,scope=formula(hel.rda.fulsoil.full),Pin=0.05,R2scope=TRUE)
tree.sel

##Just the variables forward selected
hel.rda.fulsoil = rda(tree.hel.all.pcnm[,5:205], tree.hel.all.pcnm[,c(289,284,306:307,299)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

# Now that we have these parsimonious models, NOW WE CAN PERFORM VARIANCE PARTITIONING!  Hurray!
varpart(tree.hel.all.pcnm[,5:205], tree.hel.all.pcnm[,c(248:282)], tree.hel.all.pcnm[,c(289,284,306:307,299)])
# The variance explained by soil variables and spatial structure clearly overlap. 
# It also appears that there is more independent spatial structure in the trees than independent structuring by soil.
# Are the soil variables significant after accounting for spatial structure, and vice versa?
# Let's see.
hel.rda.all.partpcnm=rda(tree.hel.all.pcnm[,10:43], tree.hel.all.pcnm[,c(248:282)], tree.hel.all.pcnm[,c(289,284,306:307,299)])
anova(hel.rda.all.partpcnm)
# Yes.
hel.rda.all.partsoil=rda(tree.hel.all.pcnm[,10:43], tree.hel.all.pcnm[,c(289,284,306:307,299)], tree.hel.all.pcnm[,c(248:282)])
anova(hel.rda.all.partsoil)
# Also yes.  But only by p-value; that is really not much variance explained anymore.

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(date1[,5:205]~date1$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
date1=date1.2[date1.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(date1[,5:205], date1[,215:239])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(date1[,5:205],date1[,c(249:282)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(date1)
all.geog.dist=vegdist(date1[,246:247],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(date1,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(date1,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:205], tree.hel.all.pcnm[,284:320])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(date1[,5:205]~date1$TerrType)
anova(hel.rda.fulsoil)
```
```{r RDA Date 2}
#remove NAs.
date2=na.omit(date2)
#save a back-up for later, just in case.
date2.2=date2
##rda by soil
hel.rda.fulsoil = rda(date2[,5:205], date2[,215:239])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(date2[,5:205],date2[,c(248:282)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(date2)
all.geog.dist=vegdist(date2[,246:247],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(date2,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(date2,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,284:323], tree.hel.all.pcnm[,299:317])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

###Pitter patter, let's get atter. Let's do that sweet sweet forward selection
##Forward selection
hel.rda.fulsoil.none = rda(tree.hel.all.pcnm[,5:205]~1)
hel.rda.fulsoil = rda(tree.hel.all.pcnm[,5:205], tree.hel.all.pcnm[,284:323])

hel.rda.fulsoil.full=rda(tree.hel.all.pcnm[,5:205]~tree.hel.all.pcnm$PCNM1+tree.hel.all.pcnm$PCNM2+tree.hel.all.pcnm$PCNM3+tree.hel.all.pcnm$PCNM4+tree.hel.all.pcnm$PCNM5+tree.hel.all.pcnm$PCNM6+tree.hel.all.pcnm$PCNM7+tree.hel.all.pcnm$PCNM8+tree.hel.all.pcnm$PCNM9+tree.hel.all.pcnm$PCNM10+tree.hel.all.pcnm$PCNM11+tree.hel.all.pcnm$PCNM12+tree.hel.all.pcnm$PCNM13+tree.hel.all.pcnm$PCNM14+tree.hel.all.pcnm$PCNM15+tree.hel.all.pcnm$PCNM16+tree.hel.all.pcnm$PCNM17+tree.hel.all.pcnm$PCNM18+tree.hel.all.pcnm$PCNM19+tree.hel.all.pcnm$PCNM20+tree.hel.all.pcnm$PCNM21+tree.hel.all.pcnm$PCNM22+tree.hel.all.pcnm$PCNM23+tree.hel.all.pcnm$PCNM24+tree.hel.all.pcnm$PCNM25+tree.hel.all.pcnm$PCNM26+tree.hel.all.pcnm$PCNM27+tree.hel.all.pcnm$PCNM28+tree.hel.all.pcnm$PCNM29+tree.hel.all.pcnm$PCNM30+tree.hel.all.pcnm$PCNM31+tree.hel.all.pcnm$PCNM32+tree.hel.all.pcnm$PCNM33+tree.hel.all.pcnm$PCNM34+tree.hel.all.pcnm$PCNM35+tree.hel.all.pcnm$PCNM36+tree.hel.all.pcnm$PCNM37+tree.hel.all.pcnm$PCNM38+tree.hel.all.pcnm$PCNM39+tree.hel.all.pcnm$PCNM40)

tree.sel=ordiR2step(hel.rda.fulsoil.none,scope=formula(hel.rda.fulsoil.full),Pin=0.05,R2scope=TRUE)
tree.sel

##Just the variables forward selected
hel.rda.fulsoil = rda(tree.hel.all.pcnm[,5:205], tree.hel.all.pcnm[,c(320)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(date2[,5:205]~date2$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE PLOTS####
date2=date2.2[date2.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(date2[,5:205], date2[,215:239])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

###Pitter patter, let's get atter. Let's do that sweet sweet forward selection
##Forward selection
hel.rda.fulsoil.none = rda(date2[,5:205]~1)
hel.rda.fulsoil = rda(date2[,5:205], date2[,215:239])

hel.rda.fulsoil.full=rda(date2[,5:205]~date2$Ptot_long+date2$Po_long+date2$pH_long+date2$moist_long+date2$ps1_long+date2$ps2_long+date2$percc_long+date2$cton_long+date2$Ptot_nug+date2$Po_nug+date2$pH_nug+date2$moist_nug+date2$ps1_nug+date2$ps2_nug+date2$percc_nug+date2$pomc_nug+date2$cton_nug+date2$Ptot_short+date2$Po_short+date2$pH_short+date2$moist_short+date2$ps1_short+date2$percc_short+date2$pomc_short+date2$cton_short)

tree.sel=ordiR2step(hel.rda.fulsoil.none,scope=formula(hel.rda.fulsoil.full),Pin=0.05,R2scope=TRUE)
tree.sel

##Just the variables forward selected
hel.rda.fulsoil = rda(date2[,5:205], date2[,c(222,239,238)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(date2[,5:205],date2[,248:282])
anova(hel.rda.fulsoil)

##Pitfall inverts by PCNM
colnames(date2)
all.geog.dist=vegdist(date2[,246:247],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(date2,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(date2,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:205], tree.hel.all.pcnm[,284:307])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(date2[,5:205]~date2$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE+EDGE####
date2=date2.2[date2.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(date2[,5:205], date2[,215:239])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(date2[,5:205],date2[,c(248:282)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(date2)
all.geog.dist=vegdist(date2[,246:247],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(date2,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(date2,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:205], tree.hel.all.pcnm[,284:319])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

## Variance partitioning - Not needed becausse no soil/pcnm effects.

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(date2[,5:205]~date2$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared
```
```{r RDA Date 3}
#remove NAs.
date3=na.omit(date3)
#save a back-up for later, just in case.
date3.2=date3
##rda by soil
hel.rda.fulsoil = rda(date3[,5:205], date3[,215:239])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(date3[,5:205],date3[,c(248:282)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(date3)
all.geog.dist=vegdist(date3[,246:247],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(date3,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(date3,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:205], tree.hel.all.pcnm[,284:327])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(date3[,5:205]~date3$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
date3=date3.2[date3.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(date3[,5:205], date3[,215:239])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(date3[,5:205],date3[,c(248:282)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

###Pitter patter, let's get atter. Let's do that sweet sweet forward selection
##Forward selection
hel.rda.fulsoil.none = rda(date3[,5:205]~1)
hel.rda.fulsoil = rda(date3[,5:205], date3[,248:282])

hel.rda.fulsoil.full=rda(date3[,5:205]~date3$ACERUB+date3$ACESAC+date3$ACESIL+date3$BETALL+date3$CARCAR+date3$CARCOR+date3$CARTOM+date3$CORFLO+date3$CRAPUN+date3$FAGAME+date3$FRAAME+date3$FRANIG+date3$HAMVIR+date3$LIRTUP+date3$MAGACU+date3$MALCOR+date3$NYSSYL+date3$OSTVIR+date3$PLAOCC+date3$POPDEL+date3$POPGRA+date3$PRUSER+date3$QUEALB+date3$QUEBIC+date3$QUEPAL+date3$QUERUB+date3$SALNIG+date3$SASALB+date3$TILAME+date3$TOXVER+date3$ULMAME+date3$ULMRUB+date3$ULMSP+date3$VIBLEN)

tree.sel=ordiR2step(hel.rda.fulsoil.none,scope=formula(hel.rda.fulsoil.full),Pin=0.05,R2scope=TRUE)
tree.sel

##Just the variables forward selected
hel.rda.fulsoil = rda(date3[,5:205], date3[,c(248:282)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(date3)
all.geog.dist=vegdist(date3[,246:247],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(date3,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(date3,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:205], tree.hel.all.pcnm[,284:308])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

## Variance partitioning not needed because there's no pcnm effect.

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(date3[,5:205]~date3$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
date3=date3.2[date3.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(date3[,5:205], date3[,215:239])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(date3[,5:205],date3[,c(248:282)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(date3)
all.geog.dist=vegdist(date3[,246:247],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(date3,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(date3,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:205], tree.hel.all.pcnm[,284:321])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

## Variance partitioning not needed because no pcnm effect.

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(date3[,5:205]~date3$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared
```
```{r RDA Date 4}
#remove NAs.
date4=na.omit(date4)
#save a back-up for later, just in case.
date4.2=date4
##rda by soil
hel.rda.fulsoil = rda(date4[,5:205], date4[,215:239])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(date4[,5:205],date4[,c(248:282)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(date4)
all.geog.dist=vegdist(date4[,246:247],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(date4,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(date4,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:205], tree.hel.all.pcnm[,284:326])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## No variance partitioning because no soil/pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(date4[,5:205]~date4$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE PLOTS####
date4=date4.2[date4.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(date4[,5:205], date4[,215:239])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(date4[,5:205],date4[,c(248:282)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(date4)
all.geog.dist=vegdist(date4[,246:247],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(date4,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(date4,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:205], tree.hel.all.pcnm[,284:308])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

## No variance partitioning because no soil/pcnm effects

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(date4[,5:205]~date4$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
date4=date4.2[date4.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(date4[,5:205], date4[,215:239])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(date4[,5:205],date4[,c(248:282)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(date4)
all.geog.dist=vegdist(date4[,246:247],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(date4,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(date4,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:205], tree.hel.all.pcnm[,284:321])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

## No variance partitioning because no soil/pcnm effects.

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(date4[,5:205]~date4$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared
```

Decoupling Stats - Order-wide.
```{r Date 1}
#### Aranaea ####
aranaea.d1=date1[,c(1:4,6:25,206:283)]
#remove NAs.
aranaea.d1=na.omit(aranaea.d1)
#save a back-up for later, just in case.
aranaea.d1.2=aranaea.d1
##rda by soil
colnames(aranaea.d1)
hel.rda.fulsoil = rda(aranaea.d1[,5:24], aranaea.d1[,35:59])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(aranaea.d1[,5:24],aranaea.d1[,c(68:102)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(aranaea.d1)
all.geog.dist=vegdist(aranaea.d1[,65:66],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(aranaea.d1,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(aranaea.d1,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:24], tree.hel.all.pcnm[,103:139])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(aranaea.d1[,5:24]~aranaea.d1$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
aranaea.d1=aranaea.d1.2[aranaea.d1.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(aranaea.d1[,5:24], aranaea.d1[,35:59])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(aranaea.d1[,5:24],aranaea.d1[,67:101])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(aranaea.d1)
all.geog.dist=vegdist(aranaea.d1[,65:66],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(aranaea.d1,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(aranaea.d1,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:24], tree.hel.all.pcnm[,103:139])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(aranaea.d1[,5:24]~aranaea.d1$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
aranaea.d1=aranaea.d1.2[aranaea.d1.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(aranaea.d1[,5:24], aranaea.d1[,34:58])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(aranaea.d1[,5:24],aranaea.d1[,c(67:101)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(aranaea.d1)
all.geog.dist=vegdist(aranaea.d1[,65:66],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(aranaea.d1,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(aranaea.d1,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:24], tree.hel.all.pcnm[,103:126])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

## no variance partitioning needed because no significance/soil effect.

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(aranaea.d1[,5:24]~aranaea.d1$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


#### Coleoptera ####
coleoptera.d1=date1[,c(1:4,28:67,206:283)]
#remove NAs.
coleoptera.d1=na.omit(coleoptera.d1)
#save a back-up for later, just in case.
coleoptera.d1.2=coleoptera.d1
##rda by soil
colnames(coleoptera.d1)
hel.rda.fulsoil = rda(coleoptera.d1[,5:44], coleoptera.d1[,54:78])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(coleoptera.d1[,5:44],coleoptera.d1[,c(87:121)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(coleoptera.d1)
all.geog.dist=vegdist(coleoptera.d1[,85:86],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(coleoptera.d1,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(coleoptera.d1,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:44], tree.hel.all.pcnm[,123:159])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

## Forward Selection
hel.rda.fulsoil.none = rda(tree.hel.all.pcnm[,5:44]~1)
.hel.rda.fulsoil = rda(tree.hel.all.pcnm[,5:44], tree.hel.all.pcnm[,119:134])

hel.rda.fulsoil.full=rda(tree.hel.all.pcnm[,5:44]~tree.hel.all.pcnm$PCNM1+tree.hel.all.pcnm$PCNM2+tree.hel.all.pcnm$PCNM3+tree.hel.all.pcnm$PCNM4+tree.hel.all.pcnm$PCNM5+tree.hel.all.pcnm$PCNM6+tree.hel.all.pcnm$PCNM7+tree.hel.all.pcnm$PCNM8+tree.hel.all.pcnm$PCNM9+tree.hel.all.pcnm$PCNM10+tree.hel.all.pcnm$PCNM11+tree.hel.all.pcnm$PCNM12+tree.hel.all.pcnm$PCNM13+tree.hel.all.pcnm$PCNM14+tree.hel.all.pcnm$PCNM15+tree.hel.all.pcnm$PCNM16)

tree.sel=ordiR2step(hel.rda.fulsoil.none,scope=formula(hel.rda.fulsoil.full),Pin=0.05,R2scope=TRUE)
tree.sel

##Just the variables forward selected
hel.rda.fulsoil = rda(tree.hel.all.pcnm[,5:44], tree.hel.all.pcnm[,c(124,126,128,130,138)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(coleoptera.d1[,5:44]~coleoptera.d1$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
coleoptera.d1=coleoptera.d1.2[coleoptera.d1.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(coleoptera.d1[,5:44], coleoptera.d1[,54:78])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(coleoptera.d1[,5:44],coleoptera.d1[,87:121])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(coleoptera.d1)
all.geog.dist=vegdist(coleoptera.d1[,85:86],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(coleoptera.d1,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(coleoptera.d1,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:44], tree.hel.all.pcnm[,123:159])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(coleoptera.d1[,5:44]~coleoptera.d1$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
coleoptera.d1=coleoptera.d1.2[coleoptera.d1.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(coleoptera.d1[,5:44], coleoptera.d1[,54:78])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(coleoptera.d1[,5:44],coleoptera.d1[,c(87:121)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

###Pitter patter, let's get atter. Let's do that sweet sweet forward selection
##Forward selection
hel.rda.fulsoil.none = rda(coleoptera.d1[,5:44]~1)
hel.rda.fulsoil = rda(coleoptera.d1[,5:44], coleoptera.d1[,87:121])

hel.rda.fulsoil.full=rda(coleoptera.d1[,5:44]~coleoptera.d1$ACERUB+coleoptera.d1$ACESAC+coleoptera.d1$ACESIL+coleoptera.d1$BETALL+coleoptera.d1$CARCAR+coleoptera.d1$CARCOR+coleoptera.d1$CARTOM+coleoptera.d1$CORFLO+coleoptera.d1$CRAPUN+coleoptera.d1$FAGAME+coleoptera.d1$FRAAME+coleoptera.d1$FRANIG+coleoptera.d1$HAMVIR+coleoptera.d1$LIRTUP+coleoptera.d1$MAGACU+coleoptera.d1$MALCOR+coleoptera.d1$NYSSYL+coleoptera.d1$OSTVIR+coleoptera.d1$PLAOCC+coleoptera.d1$POPDEL+coleoptera.d1$POPGRA+coleoptera.d1$PRUSER+coleoptera.d1$QUEALB+coleoptera.d1$QUEBIC+coleoptera.d1$QUEPAL+coleoptera.d1$QUERUB+coleoptera.d1$SALNIG+coleoptera.d1$SASALB+coleoptera.d1$TILAME+coleoptera.d1$TOXVER+coleoptera.d1$ULMAME+coleoptera.d1$ULMRUB+coleoptera.d1$ULMSP+coleoptera.d1$VIBLEN)

tree.sel=ordiR2step(hel.rda.fulsoil.none,scope=formula(hel.rda.fulsoil.full),Pin=0.05,R2scope=TRUE)
tree.sel

##Just the variables forward selected
hel.rda.fulsoil = rda(coleoptera.d1[,5:44], coleoptera.d1[,c(248:282)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(coleoptera.d1)
all.geog.dist=vegdist(coleoptera.d1[,85:86],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(coleoptera.d1,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(coleoptera.d1,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:44], tree.hel.all.pcnm[,123:146])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

## no variance partitioning needed because no significance/soil effect.

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(coleoptera.d1[,5:44]~coleoptera.d1$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

#### Chilopoda ####
chilopoda.d1=date1[,c(1:4,71:73,206:283)]
#remove NAs.
chilopoda.d1=na.omit(chilopoda.d1)
#save a back-up for later, just in case.
chilopoda.d1.2=chilopoda.d1
##rda by soil
colnames(chilopoda.d1)
hel.rda.fulsoil = rda(chilopoda.d1[,5:7], chilopoda.d1[,17:41])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(chilopoda.d1[,5:7],chilopoda.d1[,c(50:84)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(chilopoda.d1)
all.geog.dist=vegdist(chilopoda.d1[,48:49],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(chilopoda.d1,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(chilopoda.d1,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:7], tree.hel.all.pcnm[,86:128])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(chilopoda.d1[,5:7]~chilopoda.d1$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
chilopoda.d1=chilopoda.d1.2[chilopoda.d1.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(chilopoda.d1[,5:7], chilopoda.d1[,17:41])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(chilopoda.d1[,5:7],chilopoda.d1[,50:84])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(chilopoda.d1)
all.geog.dist=vegdist(chilopoda.d1[,48:49],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(chilopoda.d1,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(chilopoda.d1,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:7], tree.hel.all.pcnm[,86:122])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(chilopoda.d1[,5:7]~chilopoda.d1$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
chilopoda.d1=chilopoda.d1.2[chilopoda.d1.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(chilopoda.d1[,5:7], chilopoda.d1[,17:41])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(chilopoda.d1[,5:7],chilopoda.d1[,c(50:84)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(chilopoda.d1)
all.geog.dist=vegdist(chilopoda.d1[,48:49],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(chilopoda.d1,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(chilopoda.d1,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:7], tree.hel.all.pcnm[,86:109])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

## no variance partitioning needed because no significance/soil effect.

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(chilopoda.d1[,5:7]~chilopoda.d1$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

#### Diplopoda ####
diplopoda.d1=date1[,c(1:4,75:79,206:283)]
#remove NAs.
diplopoda.d1=na.omit(diplopoda.d1)
#save a back-up for later, just in case.
diplopoda.d1.2=diplopoda.d1
##rda by soil
colnames(diplopoda.d1)
hel.rda.fulsoil = rda(diplopoda.d1[,5:9], diplopoda.d1[,19:43])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(diplopoda.d1[,5:9],diplopoda.d1[,c(52:86)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(diplopoda.d1)
all.geog.dist=vegdist(diplopoda.d1[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(diplopoda.d1,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(diplopoda.d1,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:124])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(diplopoda.d1[,5:9]~diplopoda.d1$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
diplopoda.d1=diplopoda.d1.2[diplopoda.d1.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(diplopoda.d1[,5:9], diplopoda.d1[,19:43])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(diplopoda.d1[,5:9],diplopoda.d1[,52:86])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(diplopoda.d1)
all.geog.dist=vegdist(diplopoda.d1[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(diplopoda.d1,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(diplopoda.d1,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:124])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(diplopoda.d1[,5:9]~diplopoda.d1$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
diplopoda.d1=diplopoda.d1.2[diplopoda.d1.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(diplopoda.d1[,5:9], diplopoda.d1[,19:43])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(diplopoda.d1[,5:9],diplopoda.d1[,c(52:86)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(diplopoda.d1)
all.geog.dist=vegdist(diplopoda.d1[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(diplopoda.d1,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(diplopoda.d1,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:111])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

## no variance partitioning needed because no significance/soil effect.

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(diplopoda.d1[,5:9]~diplopoda.d1$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

#### Diptera ####
diptera.d1=date1[,c(1:4,81:105,206:283)]
#remove NAs.
diptera.d1=na.omit(diptera.d1)
#save a back-up for later, just in case.
diptera.d1.2=diptera.d1
##rda by soil
colnames(diptera.d1)
hel.rda.fulsoil = rda(diptera.d1[,5:29], diptera.d1[,39:63])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(diptera.d1[,5:29],diptera.d1[,c(72:106)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(diptera.d1)
all.geog.dist=vegdist(diptera.d1[,70:71],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(diptera.d1,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(diptera.d1,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:29], tree.hel.all.pcnm[,108:144])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(diptera.d1[,5:29]~diptera.d1$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
diptera.d1=diptera.d1.2[diptera.d1.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(diptera.d1[,5:29], diptera.d1[,39:63])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(diptera.d1[,5:29],diptera.d1[,72:106])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(diptera.d1)
all.geog.dist=vegdist(diptera.d1[,70:71],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(diptera.d1,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(diptera.d1,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:29], tree.hel.all.pcnm[,108:144])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(diptera.d1[,5:29]~diptera.d1$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
diptera.d1=diptera.d1.2[diptera.d1.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(diptera.d1[,5:29], diptera.d1[,39:63])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(diptera.d1[,5:29],diptera.d1[,c(72:106)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(diptera.d1)
all.geog.dist=vegdist(diptera.d1[,70:71],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(diptera.d1,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(diptera.d1,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:29], tree.hel.all.pcnm[,108:131])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

## no variance partitioning needed because no significance/soil effect.

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(diptera.d1[,5:29]~diptera.d1$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

#### Gastropoda ####
gastropoda.d1=date1[,c(1:4,107:116,206:283)]
#remove NAs.
gastropoda.d1=na.omit(gastropoda.d1)
#save a back-up for later, just in case.
gastropoda.d1.2=gastropoda.d1
##rda by soil
colnames(gastropoda.d1)
hel.rda.fulsoil = rda(gastropoda.d1[,5:14], gastropoda.d1[,24:48])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(gastropoda.d1[,5:14],gastropoda.d1[,c(57:91)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(gastropoda.d1)
all.geog.dist=vegdist(gastropoda.d1[,55:56],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(gastropoda.d1,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(gastropoda.d1,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:14], tree.hel.all.pcnm[,93:135])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(gastropoda.d1[,5:14]~gastropoda.d1$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
gastropoda.d1=gastropoda.d1.2[gastropoda.d1.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(gastropoda.d1[,5:14], gastropoda.d1[,24:48])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(gastropoda.d1[,5:14],gastropoda.d1[,57:91])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(gastropoda.d1)
all.geog.dist=vegdist(gastropoda.d1[,55:56],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(gastropoda.d1,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(gastropoda.d1,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:14], tree.hel.all.pcnm[,93:129])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(gastropoda.d1[,5:14]~gastropoda.d1$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
gastropoda.d1=gastropoda.d1.2[gastropoda.d1.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(gastropoda.d1[,5:14], gastropoda.d1[,24:48])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(gastropoda.d1[,5:14],gastropoda.d1[,c(57:91)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(gastropoda.d1)
all.geog.dist=vegdist(gastropoda.d1[,55:56],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(gastropoda.d1,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(gastropoda.d1,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:14], tree.hel.all.pcnm[,93:116])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

## no variance partitioning needed because no significance/soil effect.

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(gastropoda.d1[,5:14]~gastropoda.d1$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

#### Hemiptera ####
hemiptera.d1=date1[,c(1:4,118:127,206:283)]
#remove NAs.
hemiptera.d1=na.omit(hemiptera.d1)
#save a back-up for later, just in case.
hemiptera.d1.2=hemiptera.d1
##rda by soil
colnames(hemiptera.d1)
hel.rda.fulsoil = rda(hemiptera.d1[,5:14], hemiptera.d1[,24:48])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(hemiptera.d1[,5:14],hemiptera.d1[,c(57:91)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(hemiptera.d1)
all.geog.dist=vegdist(hemiptera.d1[,55:56],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(hemiptera.d1,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(hemiptera.d1,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:14], tree.hel.all.pcnm[,93:135])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(hemiptera.d1[,5:14]~hemiptera.d1$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
hemiptera.d1=hemiptera.d1.2[hemiptera.d1.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(hemiptera.d1[,5:14], hemiptera.d1[,24:48])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(hemiptera.d1[,5:14],hemiptera.d1[,57:91])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(hemiptera.d1)
all.geog.dist=vegdist(hemiptera.d1[,55:56],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(hemiptera.d1,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(hemiptera.d1,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:14], tree.hel.all.pcnm[,93:129])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(hemiptera.d1[,5:14]~hemiptera.d1$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
hemiptera.d1=hemiptera.d1.2[hemiptera.d1.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(hemiptera.d1[,5:14], hemiptera.d1[,24:48])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(hemiptera.d1[,5:14],hemiptera.d1[,c(57:91)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(hemiptera.d1)
all.geog.dist=vegdist(hemiptera.d1[,55:56],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(hemiptera.d1,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(hemiptera.d1,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:14], tree.hel.all.pcnm[,93:116])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(hemiptera.d1[,5:14]~hemiptera.d1$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

#### Hymenoptera ####\
hymenoptera.d1=date1[,c(1:4,129:144,206:283)]
#remove NAs.
hymenoptera.d1=na.omit(hymenoptera.d1)
#save a back-up for later, just in case.
hymenoptera.d1.2=hymenoptera.d1
##rda by soil
colnames(hymenoptera.d1)
hel.rda.fulsoil = rda(hymenoptera.d1[,5:54], hymenoptera.d1[,30:54])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(hymenoptera.d1[,5:54],hymenoptera.d1[,c(63:97)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(hymenoptera.d1)
all.geog.dist=vegdist(hymenoptera.d1[,61:62],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(hymenoptera.d1,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(hymenoptera.d1,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:54], tree.hel.all.pcnm[,99:141])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(hymenoptera.d1[,5:54]~hymenoptera.d1$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
hymenoptera.d1=hymenoptera.d1.2[hymenoptera.d1.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(hymenoptera.d1[,5:54], hymenoptera.d1[,30:54])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(hymenoptera.d1[,5:54],hymenoptera.d1[,63:97])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(hymenoptera.d1)
all.geog.dist=vegdist(hymenoptera.d1[,61:62],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(hymenoptera.d1,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(hymenoptera.d1,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:54], tree.hel.all.pcnm[,99:135])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(hymenoptera.d1[,5:54]~hymenoptera.d1$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
hymenoptera.d1=hymenoptera.d1.2[hymenoptera.d1.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(hymenoptera.d1[,5:54], hymenoptera.d1[,30:54])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(hymenoptera.d1[,5:54],hymenoptera.d1[,c(63:97)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(hymenoptera.d1)
all.geog.dist=vegdist(hymenoptera.d1[,61:62],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(hymenoptera.d1,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(hymenoptera.d1,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:54], tree.hel.all.pcnm[,99:122])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

## no variance partitioning needed because no significance/soil effect.

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(hymenoptera.d1[,5:54]~hymenoptera.d1$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

#### Isopoda ####
isopoda.d1=date1[,c(1:4,146:150,206:283)]
#remove NAs.
isopoda.d1=na.omit(isopoda.d1)
#save a back-up for later, just in case.
isopoda.d1.2=isopoda.d1
##rda by soil
colnames(isopoda.d1)
hel.rda.fulsoil = rda(isopoda.d1[,5:9], isopoda.d1[,19:43])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(isopoda.d1[,5:9],isopoda.d1[,c(52:86)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(isopoda.d1)
all.geog.dist=vegdist(isopoda.d1[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(isopoda.d1,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(isopoda.d1,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:130])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(isopoda.d1[,5:9]~isopoda.d1$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
isopoda.d1=isopoda.d1.2[isopoda.d1.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(isopoda.d1[,5:9], isopoda.d1[,19:43])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(isopoda.d1[,5:9],isopoda.d1[,52:86])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(isopoda.d1)
all.geog.dist=vegdist(isopoda.d1[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(isopoda.d1,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(isopoda.d1,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:124])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(isopoda.d1[,5:9]~isopoda.d1$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
isopoda.d1=isopoda.d1.2[isopoda.d1.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(isopoda.d1[,5:9], isopoda.d1[,19:43])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(isopoda.d1[,5:9],isopoda.d1[,c(52:86)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(isopoda.d1)
all.geog.dist=vegdist(isopoda.d1[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(isopoda.d1,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(isopoda.d1,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:111])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(isopoda.d1[,5:9]~isopoda.d1$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

#### Orthoptera ####
orthoptera.d1=date1[,c(1:4,161:165,206:283)]
#remove NAs.
orthoptera.d1=na.omit(orthoptera.d1)
#save a back-up for later, just in case.
orthoptera.d1.2=orthoptera.d1
##rda by soil
colnames(orthoptera.d1)
hel.rda.fulsoil = rda(orthoptera.d1[,5:9], orthoptera.d1[,19:43])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(orthoptera.d1[,5:9],orthoptera.d1[,c(52:86)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(orthoptera.d1)
all.geog.dist=vegdist(orthoptera.d1[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(orthoptera.d1,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(orthoptera.d1,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:130])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(orthoptera.d1[,5:9]~orthoptera.d1$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
orthoptera.d1=orthoptera.d1.2[orthoptera.d1.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(orthoptera.d1[,5:9], orthoptera.d1[,19:43])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(orthoptera.d1[,5:9],orthoptera.d1[,52:86])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(orthoptera.d1)
all.geog.dist=vegdist(orthoptera.d1[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(orthoptera.d1,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(orthoptera.d1,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:124])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(orthoptera.d1[,5:9]~orthoptera.d1$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
orthoptera.d1=orthoptera.d1.2[orthoptera.d1.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(orthoptera.d1[,5:9], orthoptera.d1[,19:43])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(orthoptera.d1[,5:9],orthoptera.d1[,c(52:86)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(orthoptera.d1)
all.geog.dist=vegdist(orthoptera.d1[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(orthoptera.d1,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(orthoptera.d1,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:111])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

## no variance partitioning needed because no significance/soil effect.

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(orthoptera.d1[,5:9]~orthoptera.d1$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

#### Colembola ####
collembola.d1=date1[,c(1:4,173:205,206:283)]
#remove NAs.
collembola.d1=na.omit(collembola.d1)
#save a back-up for later, just in case.
collembola.d1.2=collembola.d1
##rda by soil
colnames(collembola.d1)
hel.rda.fulsoil = rda(collembola.d1[,5:37], collembola.d1[,47:71])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(collembola.d1[,5:37],collembola.d1[,c(80:113)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(collembola.d1)
all.geog.dist=vegdist(collembola.d1[,78:79],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(collembola.d1,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(collembola.d1,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:37], tree.hel.all.pcnm[,116:152])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(collembola.d1[,5:37]~collembola.d1$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
collembola.d1=collembola.d1.2[collembola.d1.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(collembola.d1[,5:37], collembola.d1[,47:71])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(collembola.d1[,5:37],collembola.d1[,80:113])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(collembola.d1)
all.geog.dist=vegdist(collembola.d1[,78:79],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(collembola.d1,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(collembola.d1,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:37], tree.hel.all.pcnm[,116:152])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(collembola.d1[,5:37]~collembola.d1$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
collembola.d1=collembola.d1.2[collembola.d1.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(collembola.d1[,5:37], collembola.d1[,47:71])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(collembola.d1[,5:37],collembola.d1[,c(80:113)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(collembola.d1)
all.geog.dist=vegdist(collembola.d1[,78:79],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(collembola.d1,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(collembola.d1,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:37], tree.hel.all.pcnm[,116:139])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

## no variance partitioning needed because no significance/soil effect.

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(collembola.d1[,5:37]~collembola.d1$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared
```
```{r Date 2}
#### Aranaea ####
aranaea.d2=date2[,c(1:4,6:25,206:283)]
#remove NAs.
aranaea.d2=na.omit(aranaea.d2)
#save a back-up for later, just in case.
aranaea.d2.2=aranaea.d2
##rda by soil
colnames(aranaea.d2)
hel.rda.fulsoil = rda(aranaea.d2[,5:25], aranaea.d2[,35:59])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(aranaea.d2[,5:25],aranaea.d2[,c(68:102)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(aranaea.d2)
all.geog.dist=vegdist(aranaea.d2[,66:67],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(aranaea.d2,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(aranaea.d2,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:25], tree.hel.all.pcnm[,103:142])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(aranaea.d2[,5:25]~aranaea.d2$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
aranaea.d2=aranaea.d2.2[aranaea.d2.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(aranaea.d2[,5:25], aranaea.d2[,35:59])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(aranaea.d2[,5:25],aranaea.d2[,68:102])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(aranaea.d2)
all.geog.dist=vegdist(aranaea.d2[,66:67],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(aranaea.d2,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(aranaea.d2,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:25], tree.hel.all.pcnm[,103:134])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(aranaea.d2[,5:25]~aranaea.d2$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
aranaea.d2=aranaea.d2.2[aranaea.d2.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(aranaea.d2[,5:25], aranaea.d2[,35:59])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(aranaea.d2[,5:25],aranaea.d2[,c(68:102)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(aranaea.d2)
all.geog.dist=vegdist(aranaea.d2[,66:67],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(aranaea.d2,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(aranaea.d2,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:25], tree.hel.all.pcnm[,103:125])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(aranaea.d2[,5:25]~aranaea.d2$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


#### Coleoptera ####
coleoptera.d2=date2[,c(1:4,28:67,206:283)]
#remove NAs.
coleoptera.d2=na.omit(coleoptera.d2)
#save a back-up for later, just in case.
coleoptera.d2.2=coleoptera.d2
##rda by soil
colnames(coleoptera.d2)
hel.rda.fulsoil = rda(coleoptera.d2[,5:44], coleoptera.d2[,54:78])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(coleoptera.d2[,5:44],coleoptera.d2[,c(87:121)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(coleoptera.d2)
all.geog.dist=vegdist(coleoptera.d2[,85:86],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(coleoptera.d2,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(coleoptera.d2,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:44], tree.hel.all.pcnm[,123:162])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(coleoptera.d2[,5:44]~coleoptera.d2$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
coleoptera.d2=coleoptera.d2.2[coleoptera.d2.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(coleoptera.d2[,5:44], coleoptera.d2[,54:78])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(coleoptera.d2[,5:44],coleoptera.d2[,87:121])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(coleoptera.d2)
all.geog.dist=vegdist(coleoptera.d2[,85:86],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(coleoptera.d2,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(coleoptera.d2,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:44], tree.hel.all.pcnm[,123:158])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(coleoptera.d2[,5:44]~coleoptera.d2$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
coleoptera.d2=coleoptera.d2.2[coleoptera.d2.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(coleoptera.d2[,5:44], coleoptera.d2[,54:78])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(coleoptera.d2[,5:44],coleoptera.d2[,c(87:121)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(coleoptera.d2)
all.geog.dist=vegdist(coleoptera.d2[,85:86],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(coleoptera.d2,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(coleoptera.d2,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:44], tree.hel.all.pcnm[,123:146])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

## no variance partitioning needed because no significance/soil effect.

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(coleoptera.d2[,5:44]~coleoptera.d2$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

#### Chilopoda ####
chilopoda.d2=date2[,c(1:4,71:73,206:283)]
#remove NAs.
chilopoda.d2=na.omit(chilopoda.d2)
#save a back-up for later, just in case.
chilopoda.d2.2=chilopoda.d2
##rda by soil
colnames(chilopoda.d2)
hel.rda.fulsoil = rda(chilopoda.d2[,5:7], chilopoda.d2[,17:41])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(chilopoda.d2[,5:7],chilopoda.d2[,c(50:84)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(chilopoda.d2)
all.geog.dist=vegdist(chilopoda.d2[,48:49],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(chilopoda.d2,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(chilopoda.d2,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:7], tree.hel.all.pcnm[,86:125])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(chilopoda.d2[,5:7]~chilopoda.d2$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
chilopoda.d2=chilopoda.d2.2[chilopoda.d2.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(chilopoda.d2[,5:7], chilopoda.d2[,17:41])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(chilopoda.d2[,5:7],chilopoda.d2[,50:84])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(chilopoda.d2)
all.geog.dist=vegdist(chilopoda.d2[,48:49],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(chilopoda.d2,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(chilopoda.d2,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:7], tree.hel.all.pcnm[,86:121])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(chilopoda.d2[,5:7]~chilopoda.d2$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
chilopoda.d2=chilopoda.d2.2[chilopoda.d2.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(chilopoda.d2[,5:7], chilopoda.d2[,17:41])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(chilopoda.d2[,5:7],chilopoda.d2[,c(50:84)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(chilopoda.d2)
all.geog.dist=vegdist(chilopoda.d2[,48:49],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(chilopoda.d2,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(chilopoda.d2,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:7], tree.hel.all.pcnm[,86:109])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

## no variance partitioning needed because no significance/soil effect.

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(chilopoda.d2[,5:7]~chilopoda.d2$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

#### Diplopoda ####
diplopoda.d2=date2[,c(1:4,75:79,206:283)]
#remove NAs.
diplopoda.d2=na.omit(diplopoda.d2)
#save a back-up for later, just in case.
diplopoda.d2.2=diplopoda.d2
##rda by soil
colnames(diplopoda.d2)
hel.rda.fulsoil = rda(diplopoda.d2[,5:9], diplopoda.d2[,19:43])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(diplopoda.d2[,5:9],diplopoda.d2[,c(52:86)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(diplopoda.d2)
all.geog.dist=vegdist(diplopoda.d2[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(diplopoda.d2,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(diplopoda.d2,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:127])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(diplopoda.d2[,5:9]~diplopoda.d2$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
diplopoda.d2=diplopoda.d2.2[diplopoda.d2.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(diplopoda.d2[,5:9], diplopoda.d2[,19:43])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(diplopoda.d2[,5:9],diplopoda.d2[,52:86])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(diplopoda.d2)
all.geog.dist=vegdist(diplopoda.d2[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(diplopoda.d2,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(diplopoda.d2,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:123])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(diplopoda.d2[,5:9]~diplopoda.d2$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
diplopoda.d2=diplopoda.d2.2[diplopoda.d2.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(diplopoda.d2[,5:9], diplopoda.d2[,19:43])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(diplopoda.d2[,5:9],diplopoda.d2[,c(52:86)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(diplopoda.d2)
all.geog.dist=vegdist(diplopoda.d2[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(diplopoda.d2,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(diplopoda.d2,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:111])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

## no variance partitioning needed because no significance/soil effect.

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(diplopoda.d2[,5:9]~diplopoda.d2$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

#### Diptera ####
diptera.d2=date2[,c(1:4,81:105,206:283)]
#remove NAs.
diptera.d2=na.omit(diptera.d2)
#save a back-up for later, just in case.
diptera.d2.2=diptera.d2
##rda by soil
colnames(diptera.d2)
hel.rda.fulsoil = rda(diptera.d2[,5:29], diptera.d2[,39:63])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(diptera.d2[,5:29],diptera.d2[,c(72:106)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(diptera.d2)
all.geog.dist=vegdist(diptera.d2[,70:71],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(diptera.d2,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(diptera.d2,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:29], tree.hel.all.pcnm[,108:147])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(diptera.d2[,5:29]~diptera.d2$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
diptera.d2=diptera.d2.2[diptera.d2.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(diptera.d2[,5:29], diptera.d2[,39:63])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(diptera.d2[,5:29],diptera.d2[,72:106])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(diptera.d2)
all.geog.dist=vegdist(diptera.d2[,70:71],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(diptera.d2,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(diptera.d2,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:29], tree.hel.all.pcnm[,108:143])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(diptera.d2[,5:29]~diptera.d2$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
diptera.d2=diptera.d2.2[diptera.d2.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(diptera.d2[,5:29], diptera.d2[,39:63])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(diptera.d2[,5:29],diptera.d2[,c(72:106)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(diptera.d2)
all.geog.dist=vegdist(diptera.d2[,70:71],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(diptera.d2,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(diptera.d2,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:29], tree.hel.all.pcnm[,108:131])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

## no variance partitioning needed because no significance/soil effect.

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(diptera.d2[,5:29]~diptera.d2$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

#### Gastropoda ####
gastropoda.d2=date2[,c(1:4,107:116,206:283)]
#remove NAs.
gastropoda.d2=na.omit(gastropoda.d2)
#save a back-up for later, just in case.
gastropoda.d2.2=gastropoda.d2
##rda by soil
colnames(gastropoda.d2)
hel.rda.fulsoil = rda(gastropoda.d2[,5:14], gastropoda.d2[,24:48])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(gastropoda.d2[,5:14],gastropoda.d2[,c(57:91)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(gastropoda.d2)
all.geog.dist=vegdist(gastropoda.d2[,55:56],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(gastropoda.d2,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(gastropoda.d2,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:14], tree.hel.all.pcnm[,93:132])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(gastropoda.d2[,5:14]~gastropoda.d2$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
gastropoda.d2=gastropoda.d2.2[gastropoda.d2.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(gastropoda.d2[,5:14], gastropoda.d2[,24:48])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(gastropoda.d2[,5:14],gastropoda.d2[,57:91])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(gastropoda.d2)
all.geog.dist=vegdist(gastropoda.d2[,55:56],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(gastropoda.d2,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(gastropoda.d2,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:14], tree.hel.all.pcnm[,93:128])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(gastropoda.d2[,5:14]~gastropoda.d2$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
gastropoda.d2=gastropoda.d2.2[gastropoda.d2.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(gastropoda.d2[,5:14], gastropoda.d2[,24:48])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(gastropoda.d2[,5:14],gastropoda.d2[,c(57:91)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(gastropoda.d2)
all.geog.dist=vegdist(gastropoda.d2[,55:56],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(gastropoda.d2,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(gastropoda.d2,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:14], tree.hel.all.pcnm[,93:116])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

## no variance partitioning needed because no significance/soil effect.

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(gastropoda.d2[,5:14]~gastropoda.d2$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

#### Hemiptera ####
hemiptera.d2=date2[,c(1:4,118:127,206:283)]
#remove NAs.
hemiptera.d2=na.omit(hemiptera.d2)
#save a back-up for later, just in case.
hemiptera.d2.2=hemiptera.d2
##rda by soil
colnames(hemiptera.d2)
hel.rda.fulsoil = rda(hemiptera.d2[,5:14], hemiptera.d2[,24:48])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(hemiptera.d2[,5:14],hemiptera.d2[,c(57:91)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(hemiptera.d2)
all.geog.dist=vegdist(hemiptera.d2[,55:56],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(hemiptera.d2,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(hemiptera.d2,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:14], tree.hel.all.pcnm[,93:132])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(hemiptera.d2[,5:14]~hemiptera.d2$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
hemiptera.d2=hemiptera.d2.2[hemiptera.d2.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(hemiptera.d2[,5:14], hemiptera.d2[,24:48])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(hemiptera.d2[,5:14],hemiptera.d2[,57:91])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(hemiptera.d2)
all.geog.dist=vegdist(hemiptera.d2[,55:56],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(hemiptera.d2,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(hemiptera.d2,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:14], tree.hel.all.pcnm[,93:128])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(hemiptera.d2[,5:14]~hemiptera.d2$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
hemiptera.d2=hemiptera.d2.2[hemiptera.d2.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(hemiptera.d2[,5:14], hemiptera.d2[,24:48])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(hemiptera.d2[,5:14],hemiptera.d2[,c(57:91)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(hemiptera.d2)
all.geog.dist=vegdist(hemiptera.d2[,55:56],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(hemiptera.d2,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(hemiptera.d2,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:14], tree.hel.all.pcnm[,93:116])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(hemiptera.d2[,5:14]~hemiptera.d2$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

#### Hymenoptera ####
hymenoptera.d2=date2[,c(1:4,129:144,206:283)]
#remove NAs.
hymenoptera.d2=na.omit(hymenoptera.d2)
#save a back-up for later, just in case.
hymenoptera.d2.2=hymenoptera.d2
##rda by soil
colnames(hymenoptera.d2)
hel.rda.fulsoil = rda(hymenoptera.d2[,5:54], hymenoptera.d2[,30:54])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(hymenoptera.d2[,5:54],hymenoptera.d2[,c(63:97)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(hymenoptera.d2)
all.geog.dist=vegdist(hymenoptera.d2[,61:62],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(hymenoptera.d2,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(hymenoptera.d2,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:54], tree.hel.all.pcnm[,99:138])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(hymenoptera.d2[,5:54]~hymenoptera.d2$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
hymenoptera.d2=hymenoptera.d2.2[hymenoptera.d2.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(hymenoptera.d2[,5:54], hymenoptera.d2[,30:54])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(hymenoptera.d2[,5:54],hymenoptera.d2[,63:97])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(hymenoptera.d2)
all.geog.dist=vegdist(hymenoptera.d2[,61:62],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(hymenoptera.d2,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(hymenoptera.d2,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:54], tree.hel.all.pcnm[,99:134])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(hymenoptera.d2[,5:54]~hymenoptera.d2$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
hymenoptera.d2=hymenoptera.d2.2[hymenoptera.d2.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(hymenoptera.d2[,5:54], hymenoptera.d2[,30:54])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(hymenoptera.d2[,5:54],hymenoptera.d2[,c(63:97)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(hymenoptera.d2)
all.geog.dist=vegdist(hymenoptera.d2[,61:62],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(hymenoptera.d2,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(hymenoptera.d2,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:54], tree.hel.all.pcnm[,99:122])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

## no variance partitioning needed because no significance/soil effect.

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(hymenoptera.d2[,5:54]~hymenoptera.d2$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

#### Isopoda ####
isopoda.d2=date2[,c(1:4,146:150,206:283)]
#remove NAs.
isopoda.d2=na.omit(isopoda.d2)
#save a back-up for later, just in case.
isopoda.d2.2=isopoda.d2
##rda by soil
colnames(isopoda.d2)
hel.rda.fulsoil = rda(isopoda.d2[,5:9], isopoda.d2[,19:43])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(isopoda.d2[,5:9],isopoda.d2[,c(52:86)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(isopoda.d2)
all.geog.dist=vegdist(isopoda.d2[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(isopoda.d2,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(isopoda.d2,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:127])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(isopoda.d2[,5:9]~isopoda.d2$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
isopoda.d2=isopoda.d2.2[isopoda.d2.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(isopoda.d2[,5:9], isopoda.d2[,19:43])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(isopoda.d2[,5:9],isopoda.d2[,52:86])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(isopoda.d2)
all.geog.dist=vegdist(isopoda.d2[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(isopoda.d2,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(isopoda.d2,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:123])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(isopoda.d2[,5:9]~isopoda.d2$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
isopoda.d2=isopoda.d2.2[isopoda.d2.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(isopoda.d2[,5:9], isopoda.d2[,19:43])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(isopoda.d2[,5:9],isopoda.d2[,c(52:86)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(isopoda.d2)
all.geog.dist=vegdist(isopoda.d2[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(isopoda.d2,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(isopoda.d2,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:111])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(isopoda.d2[,5:9]~isopoda.d2$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

#### Orthoptera ####
orthoptera.d2=date2[,c(1:4,161:165,206:283)]
#remove NAs.
orthoptera.d2=na.omit(orthoptera.d2)
#save a back-up for later, just in case.
orthoptera.d2.2=orthoptera.d2
##rda by soil
colnames(orthoptera.d2)
hel.rda.fulsoil = rda(orthoptera.d2[,5:9], orthoptera.d2[,19:43])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(orthoptera.d2[,5:9],orthoptera.d2[,c(52:86)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(orthoptera.d2)
all.geog.dist=vegdist(orthoptera.d2[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(orthoptera.d2,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(orthoptera.d2,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:127])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(orthoptera.d2[,5:9]~orthoptera.d2$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
orthoptera.d2=orthoptera.d2.2[orthoptera.d2.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(orthoptera.d2[,5:9], orthoptera.d2[,19:43])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(orthoptera.d2[,5:9],orthoptera.d2[,52:86])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(orthoptera.d2)
all.geog.dist=vegdist(orthoptera.d2[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(orthoptera.d2,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(orthoptera.d2,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:123])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(orthoptera.d2[,5:9]~orthoptera.d2$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
orthoptera.d2=orthoptera.d2.2[orthoptera.d2.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(orthoptera.d2[,5:9], orthoptera.d2[,19:43])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(orthoptera.d2[,5:9],orthoptera.d2[,c(52:86)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(orthoptera.d2)
all.geog.dist=vegdist(orthoptera.d2[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(orthoptera.d2,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(orthoptera.d2,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:111])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

## no variance partitioning needed because no significance/soil effect.

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(orthoptera.d2[,5:9]~orthoptera.d2$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

#### Colembola ####
collembola.d2=date2[,c(1:4,173:205,206:283)]
#remove NAs.
collembola.d2=na.omit(collembola.d2)
#save a back-up for later, just in case.
collembola.d2.2=collembola.d2
##rda by soil
colnames(collembola.d2)
hel.rda.fulsoil = rda(collembola.d2[,5:37], collembola.d2[,47:71])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(collembola.d2[,5:37],collembola.d2[,c(80:113)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(collembola.d2)
all.geog.dist=vegdist(collembola.d2[,78:79],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(collembola.d2,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(collembola.d2,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:37], tree.hel.all.pcnm[,116:155])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(collembola.d2[,5:37]~collembola.d2$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
collembola.d2=collembola.d2.2[collembola.d2.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(collembola.d2[,5:37], collembola.d2[,47:71])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(collembola.d2[,5:37],collembola.d2[,80:113])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(collembola.d2)
all.geog.dist=vegdist(collembola.d2[,78:79],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(collembola.d2,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(collembola.d2,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:37], tree.hel.all.pcnm[,116:151])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(collembola.d2[,5:37]~collembola.d2$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
collembola.d2=collembola.d2.2[collembola.d2.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(collembola.d2[,5:37], collembola.d2[,47:71])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(collembola.d2[,5:37],collembola.d2[,c(80:113)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(collembola.d2)
all.geog.dist=vegdist(collembola.d2[,78:79],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(collembola.d2,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(collembola.d2,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:37], tree.hel.all.pcnm[,116:139])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

## no variance partitioning needed because no significance/soil effect.

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(collembola.d2[,5:37]~collembola.d2$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared
```
```{r Date 3}
#### Aranaea ####
aranaea.d3=date3[,c(1:4,5:25,206:283)]
#remove NAs.
aranaea.d3=na.omit(aranaea.d3)
#save a back-up for later, just in case.
aranaea.d3.2=aranaea.d3
##rda by soil
colnames(aranaea.d3)
hel.rda.fulsoil = rda(aranaea.d3[,7:25], aranaea.d3[,35:59])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(aranaea.d3[,7:25],aranaea.d3[,c(68:102)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(aranaea.d3)
all.geog.dist=vegdist(aranaea.d3[,66:67],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(aranaea.d3,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(aranaea.d3,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,7:25], tree.hel.all.pcnm[,104:147])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(aranaea.d3[,7:25]~aranaea.d3$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
aranaea.d3=aranaea.d3.2[aranaea.d3.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(aranaea.d3[,7:25], aranaea.d3[,35:59])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(aranaea.d3[,7:25],aranaea.d3[,68:102])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(aranaea.d3)
all.geog.dist=vegdist(aranaea.d3[,66:67],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(aranaea.d3,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(aranaea.d3,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,7:25], tree.hel.all.pcnm[,104:141])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(aranaea.d3[,7:25]~aranaea.d3$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
aranaea.d3=aranaea.d3.2[aranaea.d3.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(aranaea.d3[,7:25], aranaea.d3[,35:59])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(aranaea.d3[,7:25],aranaea.d3[,c(68:102)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(aranaea.d3)
all.geog.dist=vegdist(aranaea.d3[,66:67],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(aranaea.d3,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(aranaea.d3,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,7:25], tree.hel.all.pcnm[,104:128])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(aranaea.d3[,7:25]~aranaea.d3$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


#### Coleoptera ####
coleoptera.d3=date3[,c(1:4,28:67,206:283)]
#remove NAs.
coleoptera.d3=na.omit(coleoptera.d3)
#save a back-up for later, just in case.
coleoptera.d3.2=coleoptera.d3
##rda by soil
colnames(coleoptera.d3)
hel.rda.fulsoil = rda(coleoptera.d3[,5:44], coleoptera.d3[,54:78])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(coleoptera.d3[,5:44],coleoptera.d3[,c(87:121)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(coleoptera.d3)
all.geog.dist=vegdist(coleoptera.d3[,85:86],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(coleoptera.d3,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(coleoptera.d3,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:44], tree.hel.all.pcnm[,123:166])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(coleoptera.d3[,5:44]~coleoptera.d3$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
coleoptera.d3=coleoptera.d3.2[coleoptera.d3.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(coleoptera.d3[,5:44], coleoptera.d3[,54:78])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(coleoptera.d3[,5:44],coleoptera.d3[,87:121])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(coleoptera.d3)
all.geog.dist=vegdist(coleoptera.d3[,85:86],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(coleoptera.d3,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(coleoptera.d3,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:44], tree.hel.all.pcnm[,123:160])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(coleoptera.d3[,5:44]~coleoptera.d3$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
coleoptera.d3=coleoptera.d3.2[coleoptera.d3.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(coleoptera.d3[,5:44], coleoptera.d3[,54:78])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(coleoptera.d3[,5:44],coleoptera.d3[,c(87:121)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(coleoptera.d3)
all.geog.dist=vegdist(coleoptera.d3[,85:86],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(coleoptera.d3,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(coleoptera.d3,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:44], tree.hel.all.pcnm[,123:147])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

## no variance partitioning needed because no significance/soil effect.

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(coleoptera.d3[,5:44]~coleoptera.d3$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

#### Chilopoda ####
chilopoda.d3=date3[,c(1:4,71:73,206:283)]
#remove NAs.
chilopoda.d3=na.omit(chilopoda.d3)
#save a back-up for later, just in case.
chilopoda.d3.2=chilopoda.d3
##rda by soil
colnames(chilopoda.d3)
hel.rda.fulsoil = rda(chilopoda.d3[,5:7], chilopoda.d3[,17:41])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(chilopoda.d3[,5:7],chilopoda.d3[,c(50:84)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(chilopoda.d3)
all.geog.dist=vegdist(chilopoda.d3[,48:49],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(chilopoda.d3,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(chilopoda.d3,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:7], tree.hel.all.pcnm[,86:129])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(chilopoda.d3[,5:7]~chilopoda.d3$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
chilopoda.d3=chilopoda.d3.2[chilopoda.d3.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(chilopoda.d3[,5:7], chilopoda.d3[,17:41])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(chilopoda.d3[,5:7],chilopoda.d3[,50:84])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(chilopoda.d3)
all.geog.dist=vegdist(chilopoda.d3[,48:49],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(chilopoda.d3,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(chilopoda.d3,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:7], tree.hel.all.pcnm[,86:123])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(chilopoda.d3[,5:7]~chilopoda.d3$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
chilopoda.d3=chilopoda.d3.2[chilopoda.d3.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(chilopoda.d3[,5:7], chilopoda.d3[,17:41])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(chilopoda.d3[,5:7],chilopoda.d3[,c(50:84)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(chilopoda.d3)
all.geog.dist=vegdist(chilopoda.d3[,48:49],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(chilopoda.d3,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(chilopoda.d3,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:7], tree.hel.all.pcnm[,86:110])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

## no variance partitioning needed because no significance/soil effect.

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(chilopoda.d3[,5:7]~chilopoda.d3$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

#### Diplopoda ####
diplopoda.d3=date3[,c(1:4,75:79,206:283)]
#remove NAs.
diplopoda.d3=na.omit(diplopoda.d3)
#save a back-up for later, just in case.
diplopoda.d3.2=diplopoda.d3
##rda by soil
colnames(diplopoda.d3)
hel.rda.fulsoil = rda(diplopoda.d3[,5:9], diplopoda.d3[,19:43])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(diplopoda.d3[,5:9],diplopoda.d3[,c(52:86)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(diplopoda.d3)
all.geog.dist=vegdist(diplopoda.d3[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(diplopoda.d3,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(diplopoda.d3,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:131])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(diplopoda.d3[,5:9]~diplopoda.d3$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
diplopoda.d3=diplopoda.d3.2[diplopoda.d3.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(diplopoda.d3[,5:9], diplopoda.d3[,19:43])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(diplopoda.d3[,5:9],diplopoda.d3[,52:86])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(diplopoda.d3)
all.geog.dist=vegdist(diplopoda.d3[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(diplopoda.d3,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(diplopoda.d3,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:125])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(diplopoda.d3[,5:9]~diplopoda.d3$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
diplopoda.d3=diplopoda.d3.2[diplopoda.d3.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(diplopoda.d3[,5:9], diplopoda.d3[,19:43])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(diplopoda.d3[,5:9],diplopoda.d3[,c(52:86)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(diplopoda.d3)
all.geog.dist=vegdist(diplopoda.d3[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(diplopoda.d3,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(diplopoda.d3,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:112])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

## no variance partitioning needed because no significance/soil effect.

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(diplopoda.d3[,5:9]~diplopoda.d3$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

#### Diptera ####
diptera.d3=date3[,c(1:4,81:105,206:283)]
#remove NAs.
diptera.d3=na.omit(diptera.d3)
#save a back-up for later, just in case.
diptera.d3.2=diptera.d3
##rda by soil
colnames(diptera.d3)
hel.rda.fulsoil = rda(diptera.d3[,5:29], diptera.d3[,39:63])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(diptera.d3[,5:29],diptera.d3[,c(72:106)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(diptera.d3)
all.geog.dist=vegdist(diptera.d3[,70:71],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(diptera.d3,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(diptera.d3,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:29], tree.hel.all.pcnm[,108:151])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(diptera.d3[,5:29]~diptera.d3$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
diptera.d3=diptera.d3.2[diptera.d3.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(diptera.d3[,5:29], diptera.d3[,39:63])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(diptera.d3[,5:29],diptera.d3[,72:106])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(diptera.d3)
all.geog.dist=vegdist(diptera.d3[,70:71],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(diptera.d3,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(diptera.d3,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:29], tree.hel.all.pcnm[,108:145])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(diptera.d3[,5:29]~diptera.d3$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
diptera.d3=diptera.d3.2[diptera.d3.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(diptera.d3[,5:29], diptera.d3[,39:63])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(diptera.d3[,5:29],diptera.d3[,c(72:106)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(diptera.d3)
all.geog.dist=vegdist(diptera.d3[,70:71],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(diptera.d3,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(diptera.d3,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:29], tree.hel.all.pcnm[,108:132])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

## no variance partitioning needed because no significance/soil effect.

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(diptera.d3[,5:29]~diptera.d3$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

#### Gastropoda ####
gastropoda.d3=date3[,c(1:4,107:116,206:283)]
#remove NAs.
gastropoda.d3=na.omit(gastropoda.d3)
#save a back-up for later, just in case.
gastropoda.d3.2=gastropoda.d3
##rda by soil
colnames(gastropoda.d3)
hel.rda.fulsoil = rda(gastropoda.d3[,5:14], gastropoda.d3[,24:48])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(gastropoda.d3[,5:14],gastropoda.d3[,c(57:91)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(gastropoda.d3)
all.geog.dist=vegdist(gastropoda.d3[,55:56],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(gastropoda.d3,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(gastropoda.d3,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:14], tree.hel.all.pcnm[,93:136])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(gastropoda.d3[,5:14]~gastropoda.d3$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
gastropoda.d3=gastropoda.d3.2[gastropoda.d3.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(gastropoda.d3[,5:14], gastropoda.d3[,24:48])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(gastropoda.d3[,5:14],gastropoda.d3[,57:91])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(gastropoda.d3)
all.geog.dist=vegdist(gastropoda.d3[,55:56],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(gastropoda.d3,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(gastropoda.d3,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:14], tree.hel.all.pcnm[,93:130])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(gastropoda.d3[,5:14]~gastropoda.d3$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
gastropoda.d3=gastropoda.d3.2[gastropoda.d3.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(gastropoda.d3[,5:14], gastropoda.d3[,24:48])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(gastropoda.d3[,5:14],gastropoda.d3[,c(57:91)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(gastropoda.d3)
all.geog.dist=vegdist(gastropoda.d3[,55:56],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(gastropoda.d3,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(gastropoda.d3,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:14], tree.hel.all.pcnm[,93:117])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

## no variance partitioning needed because no significance/soil effect.

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(gastropoda.d3[,5:14]~gastropoda.d3$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

#### Hemiptera ####
hemiptera.d3=date3[,c(1:4,118:127,206:283)]
#remove NAs.
hemiptera.d3=na.omit(hemiptera.d3)
#save a back-up for later, just in case.
hemiptera.d3.2=hemiptera.d3
##rda by soil
colnames(hemiptera.d3)
hel.rda.fulsoil = rda(hemiptera.d3[,5:14], hemiptera.d3[,24:48])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(hemiptera.d3[,5:14],hemiptera.d3[,c(57:91)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(hemiptera.d3)
all.geog.dist=vegdist(hemiptera.d3[,55:56],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(hemiptera.d3,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(hemiptera.d3,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:14], tree.hel.all.pcnm[,93:135])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(hemiptera.d3[,5:14]~hemiptera.d3$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
hemiptera.d3=hemiptera.d3.2[hemiptera.d3.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(hemiptera.d3[,5:14], hemiptera.d3[,24:48])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(hemiptera.d3[,5:14],hemiptera.d3[,57:91])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(hemiptera.d3)
all.geog.dist=vegdist(hemiptera.d3[,55:56],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(hemiptera.d3,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(hemiptera.d3,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:14], tree.hel.all.pcnm[,93:130])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(hemiptera.d3[,5:14]~hemiptera.d3$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
hemiptera.d3=hemiptera.d3.2[hemiptera.d3.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(hemiptera.d3[,5:14], hemiptera.d3[,24:48])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(hemiptera.d3[,5:14],hemiptera.d3[,c(57:91)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(hemiptera.d3)
all.geog.dist=vegdist(hemiptera.d3[,55:56],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(hemiptera.d3,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(hemiptera.d3,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:14], tree.hel.all.pcnm[,93:117])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(hemiptera.d3[,5:14]~hemiptera.d3$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

#### Hymenoptera ####\
hymenoptera.d3=date3[,c(1:4,129:144,206:283)]
#remove NAs.
hymenoptera.d3=na.omit(hymenoptera.d3)
#save a back-up for later, just in case.
hymenoptera.d3.2=hymenoptera.d3
##rda by soil
colnames(hymenoptera.d3)
hel.rda.fulsoil = rda(hymenoptera.d3[,5:54], hymenoptera.d3[,30:54])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(hymenoptera.d3[,5:54],hymenoptera.d3[,c(63:97)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(hymenoptera.d3)
all.geog.dist=vegdist(hymenoptera.d3[,61:62],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(hymenoptera.d3,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(hymenoptera.d3,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:54], tree.hel.all.pcnm[,99:141])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(hymenoptera.d3[,5:54]~hymenoptera.d3$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
hymenoptera.d3=hymenoptera.d3.2[hymenoptera.d3.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(hymenoptera.d3[,5:54], hymenoptera.d3[,30:54])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(hymenoptera.d3[,5:54],hymenoptera.d3[,63:97])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(hymenoptera.d3)
all.geog.dist=vegdist(hymenoptera.d3[,61:62],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(hymenoptera.d3,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(hymenoptera.d3,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:54], tree.hel.all.pcnm[,99:136])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(hymenoptera.d3[,5:54]~hymenoptera.d3$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
hymenoptera.d3=hymenoptera.d3.2[hymenoptera.d3.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(hymenoptera.d3[,5:54], hymenoptera.d3[,30:54])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(hymenoptera.d3[,5:54],hymenoptera.d3[,c(63:97)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(hymenoptera.d3)
all.geog.dist=vegdist(hymenoptera.d3[,61:62],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(hymenoptera.d3,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(hymenoptera.d3,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:54], tree.hel.all.pcnm[,99:123])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

## no variance partitioning needed because no significance/soil effect.

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(hymenoptera.d3[,5:54]~hymenoptera.d3$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

#### Isopoda ####
isopoda.d3=date3[,c(1:4,146:150,206:283)]
#remove NAs.
isopoda.d3=na.omit(isopoda.d3)
#save a back-up for later, just in case.
isopoda.d3.2=isopoda.d3
##rda by soil
colnames(isopoda.d3)
hel.rda.fulsoil = rda(isopoda.d3[,5:9], isopoda.d3[,19:43])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(isopoda.d3[,5:9],isopoda.d3[,c(52:86)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(isopoda.d3)
all.geog.dist=vegdist(isopoda.d3[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(isopoda.d3,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(isopoda.d3,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:131])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(isopoda.d3[,5:9]~isopoda.d3$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
isopoda.d3=isopoda.d3.2[isopoda.d3.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(isopoda.d3[,5:9], isopoda.d3[,19:43])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(isopoda.d3[,5:9],isopoda.d3[,52:86])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(isopoda.d3)
all.geog.dist=vegdist(isopoda.d3[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(isopoda.d3,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(isopoda.d3,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:125])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(isopoda.d3[,5:9]~isopoda.d3$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
isopoda.d3=isopoda.d3.2[isopoda.d3.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(isopoda.d3[,5:9], isopoda.d3[,19:43])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(isopoda.d3[,5:9],isopoda.d3[,c(52:86)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(isopoda.d3)
all.geog.dist=vegdist(isopoda.d3[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(isopoda.d3,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(isopoda.d3,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:112])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(isopoda.d3[,5:9]~isopoda.d3$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

#### Orthoptera ####
orthoptera.d3=date3[,c(1:4,161:165,206:283)]
#remove NAs.
orthoptera.d3=na.omit(orthoptera.d3)
#save a back-up for later, just in case.
orthoptera.d3.2=orthoptera.d3
##rda by soil
colnames(orthoptera.d3)
hel.rda.fulsoil = rda(orthoptera.d3[,5:9], orthoptera.d3[,19:43])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(orthoptera.d3[,5:9],orthoptera.d3[,c(52:86)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(orthoptera.d3)
all.geog.dist=vegdist(orthoptera.d3[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(orthoptera.d3,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(orthoptera.d3,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:131])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(orthoptera.d3[,5:9]~orthoptera.d3$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
orthoptera.d3=orthoptera.d3.2[orthoptera.d3.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(orthoptera.d3[,5:9], orthoptera.d3[,19:43])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(orthoptera.d3[,5:9],orthoptera.d3[,52:86])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(orthoptera.d3)
all.geog.dist=vegdist(orthoptera.d3[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(orthoptera.d3,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(orthoptera.d3,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:125])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(orthoptera.d3[,5:9]~orthoptera.d3$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
orthoptera.d3=orthoptera.d3.2[orthoptera.d3.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(orthoptera.d3[,5:9], orthoptera.d3[,19:43])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(orthoptera.d3[,5:9],orthoptera.d3[,c(52:86)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(orthoptera.d3)
all.geog.dist=vegdist(orthoptera.d3[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(orthoptera.d3,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(orthoptera.d3,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:112])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

## no variance partitioning needed because no significance/soil effect.

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(orthoptera.d3[,5:9]~orthoptera.d3$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

#### Colembola ####
collembola.d3=date3[,c(1:4,173:205,206:283)]
#remove NAs.
collembola.d3=na.omit(collembola.d3)
#save a back-up for later, just in case.
collembola.d3.2=collembola.d3
##rda by soil
colnames(collembola.d3)
hel.rda.fulsoil = rda(collembola.d3[,5:37], collembola.d3[,47:71])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(collembola.d3[,5:37],collembola.d3[,c(80:113)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(collembola.d3)
all.geog.dist=vegdist(collembola.d3[,78:79],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(collembola.d3,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(collembola.d3,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:37], tree.hel.all.pcnm[,116:153])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(collembola.d3[,5:37]~collembola.d3$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
collembola.d3=collembola.d3.2[collembola.d3.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(collembola.d3[,5:37], collembola.d3[,47:71])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(collembola.d3[,5:37],collembola.d3[,80:113])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(collembola.d3)
all.geog.dist=vegdist(collembola.d3[,78:79],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(collembola.d3,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(collembola.d3,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:37], tree.hel.all.pcnm[,116:153])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(collembola.d3[,5:37]~collembola.d3$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
collembola.d3=collembola.d3.2[collembola.d3.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(collembola.d3[,5:37], collembola.d3[,47:71])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(collembola.d3[,5:37],collembola.d3[,c(80:113)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(collembola.d3)
all.geog.dist=vegdist(collembola.d3[,78:79],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(collembola.d3,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(collembola.d3,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:37], tree.hel.all.pcnm[,116:140])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

## no variance partitioning needed because no significance/soil effect.

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(collembola.d3[,5:37]~collembola.d3$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared
#### Diplopoda ####
diplopoda.d3=date3[,c(1:4,75:79,206:283)]
#remove NAs.
diplopoda.d3=na.omit(diplopoda.d3)
#save a back-up for later, just in case.
diplopoda.d3.2=diplopoda.d3
##rda by soil
colnames(diplopoda.d3)
hel.rda.fulsoil = rda(diplopoda.d3[,5:9], diplopoda.d3[,19:43])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(diplopoda.d3[,5:9],diplopoda.d3[,c(52:86)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(diplopoda.d3)
all.geog.dist=vegdist(diplopoda.d3[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(diplopoda.d3,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(diplopoda.d3,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:124])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(diplopoda.d3[,5:9]~diplopoda.d3$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
diplopoda.d3=diplopoda.d3.2[diplopoda.d3.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(diplopoda.d3[,5:9], diplopoda.d3[,19:43])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(diplopoda.d3[,5:9],diplopoda.d3[,52:86])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(diplopoda.d3)
all.geog.dist=vegdist(diplopoda.d3[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(diplopoda.d3,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(diplopoda.d3,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:124])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(diplopoda.d3[,5:9]~diplopoda.d3$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
diplopoda.d3=diplopoda.d3.2[diplopoda.d3.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(diplopoda.d3[,5:9], diplopoda.d3[,19:43])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(diplopoda.d3[,5:9],diplopoda.d3[,c(52:86)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(diplopoda.d3)
all.geog.dist=vegdist(diplopoda.d3[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(diplopoda.d3,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(diplopoda.d3,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:111])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

## no variance partitioning needed because no significance/soil effect.

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(diplopoda.d3[,5:9]~diplopoda.d3$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared
```
```{r Date 4}
#### Aranaea ####
aranaea.d4=date4[,c(1:4,5:25,206:283)]
#remove NAs.
aranaea.d4=na.omit(aranaea.d4)
#save a back-up for later, just in case.
aranaea.d4.2=aranaea.d4
##rda by soil
colnames(aranaea.d4)
hel.rda.fulsoil = rda(aranaea.d4[,7:25], aranaea.d4[,35:59])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(aranaea.d4[,7:25],aranaea.d4[,c(68:102)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(aranaea.d4)
all.geog.dist=vegdist(aranaea.d4[,66:67],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(aranaea.d4,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(aranaea.d4,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,7:25], tree.hel.all.pcnm[,104:146])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(aranaea.d4[,7:25]~aranaea.d4$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
aranaea.d4=aranaea.d4.2[aranaea.d4.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(aranaea.d4[,7:25], aranaea.d4[,35:59])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(aranaea.d4[,7:25],aranaea.d4[,68:102])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(aranaea.d4)
all.geog.dist=vegdist(aranaea.d4[,66:67],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(aranaea.d4,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(aranaea.d4,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,7:25], tree.hel.all.pcnm[,104:141])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(aranaea.d4[,7:25]~aranaea.d4$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
aranaea.d4=aranaea.d4.2[aranaea.d4.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(aranaea.d4[,7:25], aranaea.d4[,35:59])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(aranaea.d4[,7:25],aranaea.d4[,c(68:102)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(aranaea.d4)
all.geog.dist=vegdist(aranaea.d4[,66:67],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(aranaea.d4,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(aranaea.d4,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,7:25], tree.hel.all.pcnm[,104:128])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

## no variance partitioning needed because no significance/soil effect.

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(aranaea.d4[,7:25]~aranaea.d4$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


#### Coleoptera ####
coleoptera.d4=date4[,c(1:4,28:67,206:283)]
#remove NAs.
coleoptera.d4=na.omit(coleoptera.d4)
#save a back-up for later, just in case.
coleoptera.d4.2=coleoptera.d4
##rda by soil
colnames(coleoptera.d4)
hel.rda.fulsoil = rda(coleoptera.d4[,5:44], coleoptera.d4[,54:78])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(coleoptera.d4[,5:44],coleoptera.d4[,c(87:121)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(coleoptera.d4)
all.geog.dist=vegdist(coleoptera.d4[,85:86],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(coleoptera.d4,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(coleoptera.d4,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:44], tree.hel.all.pcnm[,123:165])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(coleoptera.d4[,5:44]~coleoptera.d4$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
coleoptera.d4=coleoptera.d4.2[coleoptera.d4.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(coleoptera.d4[,5:44], coleoptera.d4[,54:78])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(coleoptera.d4[,5:44],coleoptera.d4[,87:121])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(coleoptera.d4)
all.geog.dist=vegdist(coleoptera.d4[,85:86],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(coleoptera.d4,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(coleoptera.d4,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:44], tree.hel.all.pcnm[,123:160])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(coleoptera.d4[,5:44]~coleoptera.d4$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
coleoptera.d4=coleoptera.d4.2[coleoptera.d4.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(coleoptera.d4[,5:44], coleoptera.d4[,54:78])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(coleoptera.d4[,5:44],coleoptera.d4[,c(87:121)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(coleoptera.d4)
all.geog.dist=vegdist(coleoptera.d4[,85:86],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(coleoptera.d4,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(coleoptera.d4,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:44], tree.hel.all.pcnm[,123:147])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

## no variance partitioning needed because no significance/soil effect.

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(coleoptera.d4[,5:44]~coleoptera.d4$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

#### Chilopoda ####
chilopoda.d4=date4[,c(1:4,71:73,206:283)]
#remove NAs.
chilopoda.d4=na.omit(chilopoda.d4)
#save a back-up for later, just in case.
chilopoda.d4.2=chilopoda.d4
##rda by soil
colnames(chilopoda.d4)
hel.rda.fulsoil = rda(chilopoda.d4[,5:7], chilopoda.d4[,17:41])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(chilopoda.d4[,5:7],chilopoda.d4[,c(50:84)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(chilopoda.d4)
all.geog.dist=vegdist(chilopoda.d4[,48:49],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(chilopoda.d4,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(chilopoda.d4,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:7], tree.hel.all.pcnm[,86:128])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(chilopoda.d4[,5:7]~chilopoda.d4$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
chilopoda.d4=chilopoda.d4.2[chilopoda.d4.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(chilopoda.d4[,5:7], chilopoda.d4[,17:41])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(chilopoda.d4[,5:7],chilopoda.d4[,50:84])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(chilopoda.d4)
all.geog.dist=vegdist(chilopoda.d4[,48:49],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(chilopoda.d4,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(chilopoda.d4,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:7], tree.hel.all.pcnm[,86:123])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(chilopoda.d4[,5:7]~chilopoda.d4$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
chilopoda.d4=chilopoda.d4.2[chilopoda.d4.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(chilopoda.d4[,5:7], chilopoda.d4[,17:41])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(chilopoda.d4[,5:7],chilopoda.d4[,c(50:84)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(chilopoda.d4)
all.geog.dist=vegdist(chilopoda.d4[,48:49],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(chilopoda.d4,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(chilopoda.d4,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:7], tree.hel.all.pcnm[,86:110])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

## no variance partitioning needed because no significance/soil effect.

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(chilopoda.d4[,5:7]~chilopoda.d4$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

#### Diplopoda ####
diplopoda.d4=date4[,c(1:4,75:79,206:283)]
#remove NAs.
diplopoda.d4=na.omit(diplopoda.d4)
#save a back-up for later, just in case.
diplopoda.d4.2=diplopoda.d4
##rda by soil
colnames(diplopoda.d4)
hel.rda.fulsoil = rda(diplopoda.d4[,5:9], diplopoda.d4[,19:43])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(diplopoda.d4[,5:9],diplopoda.d4[,c(52:86)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(diplopoda.d4)
all.geog.dist=vegdist(diplopoda.d4[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(diplopoda.d4,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(diplopoda.d4,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:130])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(diplopoda.d4[,5:9]~diplopoda.d4$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
diplopoda.d4=diplopoda.d4.2[diplopoda.d4.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(diplopoda.d4[,5:9], diplopoda.d4[,19:43])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(diplopoda.d4[,5:9],diplopoda.d4[,52:86])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(diplopoda.d4)
all.geog.dist=vegdist(diplopoda.d4[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(diplopoda.d4,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(diplopoda.d4,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:125])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(diplopoda.d4[,5:9]~diplopoda.d4$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
diplopoda.d4=diplopoda.d4.2[diplopoda.d4.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(diplopoda.d4[,5:9], diplopoda.d4[,19:43])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(diplopoda.d4[,5:9],diplopoda.d4[,c(52:86)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(diplopoda.d4)
all.geog.dist=vegdist(diplopoda.d4[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(diplopoda.d4,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(diplopoda.d4,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:112])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

## no variance partitioning needed because no significance/soil effect.

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(diplopoda.d4[,5:9]~diplopoda.d4$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

#### Diptera ####
diptera.d4=date4[,c(1:4,81:105,206:283)]
#remove NAs.
diptera.d4=na.omit(diptera.d4)
#save a back-up for later, just in case.
diptera.d4.2=diptera.d4
##rda by soil
colnames(diptera.d4)
hel.rda.fulsoil = rda(diptera.d4[,5:29], diptera.d4[,39:63])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(diptera.d4[,5:29],diptera.d4[,c(72:106)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(diptera.d4)
all.geog.dist=vegdist(diptera.d4[,70:71],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(diptera.d4,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(diptera.d4,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:29], tree.hel.all.pcnm[,108:150])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(diptera.d4[,5:29]~diptera.d4$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
diptera.d4=diptera.d4.2[diptera.d4.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(diptera.d4[,5:29], diptera.d4[,39:63])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(diptera.d4[,5:29],diptera.d4[,72:106])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(diptera.d4)
all.geog.dist=vegdist(diptera.d4[,70:71],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(diptera.d4,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(diptera.d4,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:29], tree.hel.all.pcnm[,108:144])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(diptera.d4[,5:29]~diptera.d4$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
diptera.d4=diptera.d4.2[diptera.d4.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(diptera.d4[,5:29], diptera.d4[,39:63])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(diptera.d4[,5:29],diptera.d4[,c(72:106)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(diptera.d4)
all.geog.dist=vegdist(diptera.d4[,70:71],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(diptera.d4,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(diptera.d4,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:29], tree.hel.all.pcnm[,108:132])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

## no variance partitioning needed because no significance/soil effect.

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(diptera.d4[,5:29]~diptera.d4$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

#### Gastropoda ####
gastropoda.d4=date4[,c(1:4,107:116,206:283)]
#remove NAs.
gastropoda.d4=na.omit(gastropoda.d4)
#save a back-up for later, just in case.
gastropoda.d4.2=gastropoda.d4
##rda by soil
colnames(gastropoda.d4)
hel.rda.fulsoil = rda(gastropoda.d4[,5:14], gastropoda.d4[,24:48])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(gastropoda.d4[,5:14],gastropoda.d4[,c(57:91)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(gastropoda.d4)
all.geog.dist=vegdist(gastropoda.d4[,55:56],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(gastropoda.d4,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(gastropoda.d4,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:14], tree.hel.all.pcnm[,93:135])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(gastropoda.d4[,5:14]~gastropoda.d4$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
gastropoda.d4=gastropoda.d4.2[gastropoda.d4.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(gastropoda.d4[,5:14], gastropoda.d4[,24:48])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(gastropoda.d4[,5:14],gastropoda.d4[,57:91])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(gastropoda.d4)
all.geog.dist=vegdist(gastropoda.d4[,55:56],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(gastropoda.d4,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(gastropoda.d4,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:14], tree.hel.all.pcnm[,93:130])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(gastropoda.d4[,5:14]~gastropoda.d4$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
gastropoda.d4=gastropoda.d4.2[gastropoda.d4.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(gastropoda.d4[,5:14], gastropoda.d4[,24:48])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(gastropoda.d4[,5:14],gastropoda.d4[,c(57:91)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(gastropoda.d4)
all.geog.dist=vegdist(gastropoda.d4[,55:56],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(gastropoda.d4,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(gastropoda.d4,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:14], tree.hel.all.pcnm[,93:117])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

## no variance partitioning needed because no significance/soil effect.

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(gastropoda.d4[,5:14]~gastropoda.d4$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

#### Hemiptera ####
hemiptera.d4=date4[,c(1:4,118:127,206:283)]
#remove NAs.
hemiptera.d4=na.omit(hemiptera.d4)
#save a back-up for later, just in case.
hemiptera.d4.2=hemiptera.d4
##rda by soil
colnames(hemiptera.d4)
hel.rda.fulsoil = rda(hemiptera.d4[,5:14], hemiptera.d4[,24:48])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(hemiptera.d4[,5:14],hemiptera.d4[,c(57:91)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(hemiptera.d4)
all.geog.dist=vegdist(hemiptera.d4[,55:56],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(hemiptera.d4,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(hemiptera.d4,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:14], tree.hel.all.pcnm[,93:135])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(hemiptera.d4[,5:14]~hemiptera.d4$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
hemiptera.d4=hemiptera.d4.2[hemiptera.d4.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(hemiptera.d4[,5:14], hemiptera.d4[,24:48])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(hemiptera.d4[,5:14],hemiptera.d4[,57:91])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(hemiptera.d4)
all.geog.dist=vegdist(hemiptera.d4[,55:56],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(hemiptera.d4,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(hemiptera.d4,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:14], tree.hel.all.pcnm[,93:130])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(hemiptera.d4[,5:14]~hemiptera.d4$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
hemiptera.d4=hemiptera.d4.2[hemiptera.d4.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(hemiptera.d4[,5:14], hemiptera.d4[,24:48])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(hemiptera.d4[,5:14],hemiptera.d4[,c(57:91)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(hemiptera.d4)
all.geog.dist=vegdist(hemiptera.d4[,55:56],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(hemiptera.d4,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(hemiptera.d4,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:14], tree.hel.all.pcnm[,93:117])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(hemiptera.d4[,5:14]~hemiptera.d4$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

#### Hymenoptera ####
hymenoptera.d4=date4[,c(1:4,129:144,206:283)]
#remove NAs.
hymenoptera.d4=na.omit(hymenoptera.d4)
#save a back-up for later, just in case.
hymenoptera.d4.2=hymenoptera.d4
##rda by soil
colnames(hymenoptera.d4)
hel.rda.fulsoil = rda(hymenoptera.d4[,5:54], hymenoptera.d4[,30:54])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

###Pitter patter, let's get atter. Let's do that sweet sweet forward selection
##Forward selection
hel.rda.fulsoil.none = rda(hymenoptera.d4[,5:54]~1)
hel.rda.fulsoil = rda(hymenoptera.d4[,5:54], hymenoptera.d4[,30:54])

hel.rda.fulsoil.full=rda(hymenoptera.d4[,5:54]~hymenoptera.d4$Ptot_long+hymenoptera.d4$Po_long+hymenoptera.d4$pH_long+hymenoptera.d4$moist_long+hymenoptera.d4$ps1_long+hymenoptera.d4$ps2_long+hymenoptera.d4$percc_long+hymenoptera.d4$cton_long+hymenoptera.d4$Ptot_nug+hymenoptera.d4$Po_nug+hymenoptera.d4$pH_nug+hymenoptera.d4$moist_nug+hymenoptera.d4$ps1_nug+hymenoptera.d4$ps2_nug+hymenoptera.d4$percc_nug+hymenoptera.d4$pomc_nug+hymenoptera.d4$cton_nug+hymenoptera.d4$Ptot_short+hymenoptera.d4$Po_short+hymenoptera.d4$pH_short+hymenoptera.d4$moist_short+hymenoptera.d4$ps1_short+hymenoptera.d4$percc_short+hymenoptera.d4$pomc_short+hymenoptera.d4$cton_short)

tree.sel=ordiR2step(hel.rda.fulsoil.none,scope=formula(hel.rda.fulsoil.full),Pin=0.05,R2scope=TRUE)
tree.sel

##Just the variables forward selected
hel.rda.fulsoil = rda(hymenoptera.d4[,5:54], hymenoptera.d4[,c(31,33,38,35,49,53,52,40,42,44)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(hymenoptera.d4[,5:54],hymenoptera.d4[,c(63:97)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Forward selection
hel.rda.fulsoil.none = rda(hymenoptera.d4[,5:54]~1)
hel.rda.fulsoil = rda(hymenoptera.d4[,5:54], hymenoptera.d4[,63:97])

hel.rda.fulsoil.full=rda(hymenoptera.d4[,5:54]~hymenoptera.d4$ACERUB+hymenoptera.d4$ACESAC+hymenoptera.d4$ACESIL+hymenoptera.d4$BETALL+hymenoptera.d4$CARCAR+hymenoptera.d4$CARCOR+hymenoptera.d4$CAROVA+hymenoptera.d4$CARTOM+hymenoptera.d4$CORFLO+hymenoptera.d4$CRAPUN+hymenoptera.d4$FAGAME+hymenoptera.d4$FRAAME+hymenoptera.d4$FRANIG+hymenoptera.d4$HAMVIR+hymenoptera.d4$LIRTUP+hymenoptera.d4$MAGACU+hymenoptera.d4$MALCOR+hymenoptera.d4$NYSSYL+hymenoptera.d4$OSTVIR+hymenoptera.d4$PLAOCC+hymenoptera.d4$POPDEL+hymenoptera.d4$POPGRA+hymenoptera.d4$PRUSER+hymenoptera.d4$QUEALB+hymenoptera.d4$QUERUB+hymenoptera.d4$SALNIG+hymenoptera.d4$SASALB+hymenoptera.d4$TILAME+hymenoptera.d4$TOXVER+hymenoptera.d4$ULMAME+hymenoptera.d4$ULMRUB+hymenoptera.d4$ULMSP+hymenoptera.d4$VIBLEN)

tree.sel=ordiR2step(hel.rda.fulsoil.none,scope=formula(hel.rda.fulsoil.full),Pin=0.05,R2scope=TRUE)
tree.sel

##Just the variables forward selected
#hel.rda.fulsoil = rda(hymenoptera.d4[,5:54], hymenoptera.d4[,c(172,176)])
#anova(hel.rda.fulsoil)
#RsquareAdj(hel.rda.fulsoil)
#global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(hymenoptera.d4)
all.geog.dist=vegdist(hymenoptera.d4[,61:62],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(hymenoptera.d4,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(hymenoptera.d4,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:54], tree.hel.all.pcnm[,99:136])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

###Pitter patter, let's get atter. Let's do that sweet sweet forward selection
##Forward selection
hel.rda.fulsoil.none = rda(tree.hel.all.pcnm[,5:54]~1)
hel.rda.fulsoil = rda(tree.hel.all.pcnm[,5:54], tree.hel.all.pcnm[,99:136])

hel.rda.fulsoil.full=rda(tree.hel.all.pcnm[,5:54]~tree.hel.all.pcnm$PCNM1+tree.hel.all.pcnm$PCNM2+tree.hel.all.pcnm$PCNM3+tree.hel.all.pcnm$PCNM4+tree.hel.all.pcnm$PCNM5+tree.hel.all.pcnm$PCNM6+tree.hel.all.pcnm$PCNM7+tree.hel.all.pcnm$PCNM8+tree.hel.all.pcnm$PCNM9+tree.hel.all.pcnm$PCNM10+tree.hel.all.pcnm$PCNM11+tree.hel.all.pcnm$PCNM12+tree.hel.all.pcnm$PCNM13+tree.hel.all.pcnm$PCNM14+tree.hel.all.pcnm$PCNM15+tree.hel.all.pcnm$PCNM16+tree.hel.all.pcnm$PCNM17+tree.hel.all.pcnm$PCNM18+tree.hel.all.pcnm$PCNM19+tree.hel.all.pcnm$PCNM20+tree.hel.all.pcnm$PCNM21+tree.hel.all.pcnm$PCNM22+tree.hel.all.pcnm$PCNM23+tree.hel.all.pcnm$PCNM24+tree.hel.all.pcnm$PCNM25+tree.hel.all.pcnm$PCNM26+tree.hel.all.pcnm$PCNM27+tree.hel.all.pcnm$PCNM28+tree.hel.all.pcnm$PCNM29+tree.hel.all.pcnm$PCNM30+tree.hel.all.pcnm$PCNM31+tree.hel.all.pcnm$PCNM32+tree.hel.all.pcnm$PCNM33+tree.hel.all.pcnm$PCNM34+tree.hel.all.pcnm$PCNM35+tree.hel.all.pcnm$PCNM36+tree.hel.all.pcnm$PCNM37+tree.hel.all.pcnm$PCNM38)

tree.sel=ordiR2step(hel.rda.fulsoil.none,scope=formula(hel.rda.fulsoil.full),Pin=0.05,R2scope=TRUE)
tree.sel

##Just the variables forward selected
hel.rda.fulsoil = rda(tree.hel.all.pcnm[,5:54], tree.hel.all.pcnm[,c(100:102,119,124,126,130)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

# Now that we have these parsimonious models, NOW WE CAN PERFORM VARIANCE PARTITIONING!  Hurray!
varpart(tree.hel.all.pcnm[,5:54], tree.hel.all.pcnm[,c(31,33,38,35,49,53,52,40,42,44)], tree.hel.all.pcnm[,c(100:102,119,124,126,130)])
# The variance explained by soil variables and spatial structure clearly overlap. 
# It also appears that there is more independent spatial structure in the trees than independent structuring by soil.
# Are the soil variables significant after accounting for spatial structure, and vice versa?
# Let's see.
hel.rda.all.partpcnm=rda(tree.hel.all.pcnm[,5:54], tree.hel.all.pcnm[,c(31,33,38,35,49,53,52,40,42,44)], tree.hel.all.pcnm[,c(100:102,119,124,126,130)])
anova(hel.rda.all.partpcnm)
# Yes.
hel.rda.all.partsoil=rda(tree.hel.all.pcnm[,5:54], tree.hel.all.pcnm[,c(100:102,119,124,126,130)], tree.hel.all.pcnm[,c(31,33,38,35,49,53,52,40,42,44)])
anova(hel.rda.all.partsoil)
# Nope.

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(hymenoptera.d4[,5:54]~hymenoptera.d4$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
hymenoptera.d4=hymenoptera.d4.2[hymenoptera.d4.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(hymenoptera.d4[,5:54], hymenoptera.d4[,30:54])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

###Pitter patter, let's get atter. Let's do that sweet sweet forward selection
##Forward selection
hel.rda.fulsoil.none = rda(hymenoptera.d4[,5:54]~1)
hel.rda.fulsoil = rda(hymenoptera.d4[,5:54], hymenoptera.d4[,30:54])

hel.rda.fulsoil.full=rda(hymenoptera.d4[,5:54]~hymenoptera.d4$Ptot_long+hymenoptera.d4$Po_long+hymenoptera.d4$pH_long+hymenoptera.d4$moist_long+hymenoptera.d4$ps1_long+hymenoptera.d4$ps2_long+hymenoptera.d4$percc_long+hymenoptera.d4$cton_long+hymenoptera.d4$Ptot_nug+hymenoptera.d4$Po_nug+hymenoptera.d4$pH_nug+hymenoptera.d4$moist_nug+hymenoptera.d4$ps1_nug+hymenoptera.d4$ps2_nug+hymenoptera.d4$percc_nug+hymenoptera.d4$pomc_nug+hymenoptera.d4$cton_nug+hymenoptera.d4$Ptot_short+hymenoptera.d4$Po_short+hymenoptera.d4$pH_short+hymenoptera.d4$moist_short+hymenoptera.d4$ps1_short+hymenoptera.d4$percc_short+hymenoptera.d4$pomc_short+hymenoptera.d4$cton_short)

tree.sel=ordiR2step(hel.rda.fulsoil.none,scope=formula(hel.rda.fulsoil.full),Pin=0.05,R2scope=TRUE)
tree.sel

##Just the variables forward selected
hel.rda.fulsoil = rda(hymenoptera.d4[,5:54], hymenoptera.d4[,c(31,33,38,35,49,48,52,40,42,44,43,34)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(hymenoptera.d4[,5:54],hymenoptera.d4[,63:97])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Forward selection
hel.rda.fulsoil.none = rda(hymenoptera.d4[,5:54]~1)
hel.rda.fulsoil = rda(hymenoptera.d4[,5:54], hymenoptera.d4[,63:97])

hel.rda.fulsoil.full=rda(hymenoptera.d4[,5:54]~hymenoptera.d4$ACERUB+hymenoptera.d4$ACESAC+hymenoptera.d4$ACESIL+hymenoptera.d4$BETALL+hymenoptera.d4$CARCAR+hymenoptera.d4$CARCOR+hymenoptera.d4$CAROVA+hymenoptera.d4$CARTOM+hymenoptera.d4$CORFLO+hymenoptera.d4$CRAPUN+hymenoptera.d4$FAGAME+hymenoptera.d4$FRAAME+hymenoptera.d4$FRANIG+hymenoptera.d4$HAMVIR+hymenoptera.d4$LIRTUP+hymenoptera.d4$MAGACU+hymenoptera.d4$MALCOR+hymenoptera.d4$NYSSYL+hymenoptera.d4$OSTVIR+hymenoptera.d4$PLAOCC+hymenoptera.d4$POPDEL+hymenoptera.d4$POPGRA+hymenoptera.d4$PRUSER+hymenoptera.d4$QUEALB+hymenoptera.d4$QUERUB+hymenoptera.d4$SALNIG+hymenoptera.d4$SASALB+hymenoptera.d4$TILAME+hymenoptera.d4$TOXVER+hymenoptera.d4$ULMAME+hymenoptera.d4$ULMRUB+hymenoptera.d4$ULMSP+hymenoptera.d4$VIBLEN)

tree.sel=ordiR2step(hel.rda.fulsoil.none,scope=formula(hel.rda.fulsoil.full),Pin=0.05,R2scope=TRUE)
tree.sel

##Just the variables forward selected
#hel.rda.fulsoil = rda(hymenoptera.d4[,5:54], hymenoptera.d4[,c(172,176)])
#anova(hel.rda.fulsoil)
#RsquareAdj(hel.rda.fulsoil)
#global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(hymenoptera.d4)
all.geog.dist=vegdist(hymenoptera.d4[,61:62],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(hymenoptera.d4,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(hymenoptera.d4,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:54], tree.hel.all.pcnm[,99:136])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

###Pitter patter, let's get atter. Let's do that sweet sweet forward selection
##Forward selection
hel.rda.fulsoil.none = rda(tree.hel.all.pcnm[,5:54]~1)
hel.rda.fulsoil = rda(tree.hel.all.pcnm[,5:54], tree.hel.all.pcnm[,99:136])

hel.rda.fulsoil.full=rda(tree.hel.all.pcnm[,5:54]~tree.hel.all.pcnm$PCNM1+tree.hel.all.pcnm$PCNM2+tree.hel.all.pcnm$PCNM3+tree.hel.all.pcnm$PCNM4+tree.hel.all.pcnm$PCNM5+tree.hel.all.pcnm$PCNM6+tree.hel.all.pcnm$PCNM7+tree.hel.all.pcnm$PCNM8+tree.hel.all.pcnm$PCNM9+tree.hel.all.pcnm$PCNM10+tree.hel.all.pcnm$PCNM11+tree.hel.all.pcnm$PCNM12+tree.hel.all.pcnm$PCNM13+tree.hel.all.pcnm$PCNM14+tree.hel.all.pcnm$PCNM15+tree.hel.all.pcnm$PCNM16+tree.hel.all.pcnm$PCNM17+tree.hel.all.pcnm$PCNM18+tree.hel.all.pcnm$PCNM19+tree.hel.all.pcnm$PCNM20+tree.hel.all.pcnm$PCNM21+tree.hel.all.pcnm$PCNM22+tree.hel.all.pcnm$PCNM23+tree.hel.all.pcnm$PCNM24+tree.hel.all.pcnm$PCNM25+tree.hel.all.pcnm$PCNM26+tree.hel.all.pcnm$PCNM27+tree.hel.all.pcnm$PCNM28+tree.hel.all.pcnm$PCNM29+tree.hel.all.pcnm$PCNM30+tree.hel.all.pcnm$PCNM31+tree.hel.all.pcnm$PCNM32+tree.hel.all.pcnm$PCNM33+tree.hel.all.pcnm$PCNM34+tree.hel.all.pcnm$PCNM35+tree.hel.all.pcnm$PCNM36+tree.hel.all.pcnm$PCNM37+tree.hel.all.pcnm$PCNM38)

tree.sel=ordiR2step(hel.rda.fulsoil.none,scope=formula(hel.rda.fulsoil.full),Pin=0.05,R2scope=TRUE)
tree.sel

##Just the variables forward selected
hel.rda.fulsoil = rda(tree.hel.all.pcnm[,5:54], tree.hel.all.pcnm[,c(100:102,119,124,126)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

# Now that we have these parsimonious models, NOW WE CAN PERFORM VARIANCE PARTITIONING!  Hurray!
varpart(tree.hel.all.pcnm[,5:54], tree.hel.all.pcnm[,c(31,33,38,35,49,48,52,40,42,44,43,34)], tree.hel.all.pcnm[,c(100:102,119,124,126)])
# The variance explained by soil variables and spatial structure clearly overlap. 
# It also appears that there is more independent spatial structure in the trees than independent structuring by soil.
# Are the soil variables significant after accounting for spatial structure, and vice versa?
# Let's see.
hel.rda.all.partpcnm=rda(tree.hel.all.pcnm[,5:54], tree.hel.all.pcnm[,c(31,33,38,35,49,48,52,40,42,44,43,34)], tree.hel.all.pcnm[,c(100:102,119,124,126)])
anova(hel.rda.all.partpcnm)
# Yes.
hel.rda.all.partsoil=rda(tree.hel.all.pcnm[,5:54], tree.hel.all.pcnm[,c(100:102,119,124,126)], tree.hel.all.pcnm[,c(31,33,38,35,49,48,52,40,42,44,43,34)])
anova(hel.rda.all.partsoil)
# Nope.

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(hymenoptera.d4[,5:54]~hymenoptera.d4$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
hymenoptera.d4=hymenoptera.d4.2[hymenoptera.d4.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(hymenoptera.d4[,5:54], hymenoptera.d4[,30:54])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

###Pitter patter, let's get atter. Let's do that sweet sweet forward selection
##Forward selection
hel.rda.fulsoil.none = rda(hymenoptera.d4[,5:54]~1)
hel.rda.fulsoil = rda(hymenoptera.d4[,5:54], hymenoptera.d4[,30:54])

hel.rda.fulsoil.full=rda(hymenoptera.d4[,5:54]~hymenoptera.d4$Ptot_long+hymenoptera.d4$Po_long+hymenoptera.d4$pH_long+hymenoptera.d4$moist_long+hymenoptera.d4$ps1_long+hymenoptera.d4$ps2_long+hymenoptera.d4$percc_long+hymenoptera.d4$cton_long+hymenoptera.d4$Ptot_nug+hymenoptera.d4$Po_nug+hymenoptera.d4$pH_nug+hymenoptera.d4$moist_nug+hymenoptera.d4$ps1_nug+hymenoptera.d4$ps2_nug+hymenoptera.d4$percc_nug+hymenoptera.d4$pomc_nug+hymenoptera.d4$cton_nug+hymenoptera.d4$Ptot_short+hymenoptera.d4$Po_short+hymenoptera.d4$pH_short+hymenoptera.d4$moist_short+hymenoptera.d4$ps1_short+hymenoptera.d4$percc_short+hymenoptera.d4$pomc_short+hymenoptera.d4$cton_short)

tree.sel=ordiR2step(hel.rda.fulsoil.none,scope=formula(hel.rda.fulsoil.full),Pin=0.05,R2scope=TRUE)
tree.sel

##Just the variables forward selected
hel.rda.fulsoil = rda(hymenoptera.d4[,5:54], hymenoptera.d4[,c(36,33,44,48,40,35,49,50,43,45)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(hymenoptera.d4[,5:54],hymenoptera.d4[,c(63:97)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Forward selection
hel.rda.fulsoil.none = rda(hymenoptera.d4[,5:54]~1)
hel.rda.fulsoil = rda(hymenoptera.d4[,5:54], hymenoptera.d4[,63:97])

hel.rda.fulsoil.full=rda(hymenoptera.d4[,5:54]~hymenoptera.d4$ACERUB+hymenoptera.d4$ACESAC+hymenoptera.d4$ACESIL+hymenoptera.d4$BETALL+hymenoptera.d4$CARCAR+hymenoptera.d4$CARCOR+hymenoptera.d4$CAROVA+hymenoptera.d4$CARTOM+hymenoptera.d4$CORFLO+hymenoptera.d4$CRAPUN+hymenoptera.d4$FAGAME+hymenoptera.d4$FRAAME+hymenoptera.d4$FRANIG+hymenoptera.d4$HAMVIR+hymenoptera.d4$LIRTUP+hymenoptera.d4$MAGACU+hymenoptera.d4$MALCOR+hymenoptera.d4$NYSSYL+hymenoptera.d4$OSTVIR+hymenoptera.d4$PLAOCC+hymenoptera.d4$POPDEL+hymenoptera.d4$POPGRA+hymenoptera.d4$PRUSER+hymenoptera.d4$QUEALB+hymenoptera.d4$QUERUB+hymenoptera.d4$SALNIG+hymenoptera.d4$SASALB+hymenoptera.d4$TILAME+hymenoptera.d4$TOXVER+hymenoptera.d4$ULMAME+hymenoptera.d4$ULMRUB+hymenoptera.d4$ULMSP+hymenoptera.d4$VIBLEN)

tree.sel=ordiR2step(hel.rda.fulsoil.none,scope=formula(hel.rda.fulsoil.full),Pin=0.05,R2scope=TRUE)
tree.sel

##Just the variables forward selected
#hel.rda.fulsoil = rda(hymenoptera.d4[,5:54], hymenoptera.d4[,c(172,176)])
#anova(hel.rda.fulsoil)
#RsquareAdj(hel.rda.fulsoil)
#global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(hymenoptera.d4)
all.geog.dist=vegdist(hymenoptera.d4[,61:62],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(hymenoptera.d4,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(hymenoptera.d4,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:54], tree.hel.all.pcnm[,99:123])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##Forward selection
hel.rda.fulsoil.none = rda(tree.hel.all.pcnm[,5:54]~1)
hel.rda.fulsoil = rda(tree.hel.all.pcnm[,5:54], tree.hel.all.pcnm[,99:123])

hel.rda.fulsoil.full=rda(tree.hel.all.pcnm[,5:54]~tree.hel.all.pcnm$PCNM1+tree.hel.all.pcnm$PCNM2+tree.hel.all.pcnm$PCNM3+tree.hel.all.pcnm$PCNM4+tree.hel.all.pcnm$PCNM5+tree.hel.all.pcnm$PCNM6+tree.hel.all.pcnm$PCNM7+tree.hel.all.pcnm$PCNM8+tree.hel.all.pcnm$PCNM9+tree.hel.all.pcnm$PCNM10+tree.hel.all.pcnm$PCNM11+tree.hel.all.pcnm$PCNM12+tree.hel.all.pcnm$PCNM13+tree.hel.all.pcnm$PCNM14+tree.hel.all.pcnm$PCNM15+tree.hel.all.pcnm$PCNM16+tree.hel.all.pcnm$PCNM17+tree.hel.all.pcnm$PCNM18+tree.hel.all.pcnm$PCNM19+tree.hel.all.pcnm$PCNM20+tree.hel.all.pcnm$PCNM21+tree.hel.all.pcnm$PCNM22+tree.hel.all.pcnm$PCNM23+tree.hel.all.pcnm$PCNM24+tree.hel.all.pcnm$PCNM25)

tree.sel=ordiR2step(hel.rda.fulsoil.none,scope=formula(hel.rda.fulsoil.full),Pin=0.05,R2scope=TRUE)
tree.sel

##Just the variables forward selected
hel.rda.fulsoil = rda(tree.hel.all.pcnm[,5:54], tree.hel.all.pcnm[,c(99:101,112)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

# Now that we have these parsimonious models, NOW WE CAN PERFORM VARIANCE PARTITIONING!  Hurray!
varpart(tree.hel.all.pcnm[,5:54], tree.hel.all.pcnm[,c(36,33,44,48,40,35,49,50,43,45)], tree.hel.all.pcnm[,c(99:101,112)])
# The variance explained by soil variables and spatial structure clearly overlap. 
# It also appears that there is more independent spatial structure in the trees than independent structuring by soil.
# Are the soil variables significant after accounting for spatial structure, and vice versa?
# Let's see.
hel.rda.all.partpcnm=rda(tree.hel.all.pcnm[,5:54], tree.hel.all.pcnm[,c(36,33,44,48,40,35,49,50,43,45)], tree.hel.all.pcnm[,c(99:101,112)])
anova(hel.rda.all.partpcnm)
# Yes.
hel.rda.all.partsoil=rda(tree.hel.all.pcnm[,5:54], tree.hel.all.pcnm[,c(99:101,112)], tree.hel.all.pcnm[,c(36,33,44,48,40,35,49,50,43,45)])
anova(hel.rda.all.partsoil)
# Nope.

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(hymenoptera.d4[,5:54]~hymenoptera.d4$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

#### Isopoda ####
isopoda.d4=date4[,c(1:4,146:150,206:283)]
#remove NAs.
isopoda.d4=na.omit(isopoda.d4)
#save a back-up for later, just in case.
isopoda.d4.2=isopoda.d4
##rda by soil
colnames(isopoda.d4)
hel.rda.fulsoil = rda(isopoda.d4[,5:9], isopoda.d4[,19:43])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(isopoda.d4[,5:9],isopoda.d4[,c(52:86)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(isopoda.d4)
all.geog.dist=vegdist(isopoda.d4[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(isopoda.d4,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(isopoda.d4,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:130])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(isopoda.d4[,5:9]~isopoda.d4$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
isopoda.d4=isopoda.d4.2[isopoda.d4.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(isopoda.d4[,5:9], isopoda.d4[,19:43])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(isopoda.d4[,5:9],isopoda.d4[,52:86])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(isopoda.d4)
all.geog.dist=vegdist(isopoda.d4[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(isopoda.d4,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(isopoda.d4,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:125])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(isopoda.d4[,5:9]~isopoda.d4$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
isopoda.d4=isopoda.d4.2[isopoda.d4.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(isopoda.d4[,5:9], isopoda.d4[,19:43])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(isopoda.d4[,5:9],isopoda.d4[,c(52:86)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(isopoda.d4)
all.geog.dist=vegdist(isopoda.d4[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(isopoda.d4,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(isopoda.d4,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:112])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(isopoda.d4[,5:9]~isopoda.d4$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

#### Orthoptera ####
orthoptera.d4=date4[,c(1:4,161:165,206:283)]
#remove NAs.
orthoptera.d4=na.omit(orthoptera.d4)
#save a back-up for later, just in case.
orthoptera.d4.2=orthoptera.d4
##rda by soil
colnames(orthoptera.d4)
hel.rda.fulsoil = rda(orthoptera.d4[,5:9], orthoptera.d4[,19:43])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(orthoptera.d4[,5:9],orthoptera.d4[,c(52:86)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(orthoptera.d4)
all.geog.dist=vegdist(orthoptera.d4[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(orthoptera.d4,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(orthoptera.d4,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:130])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(orthoptera.d4[,5:9]~orthoptera.d4$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
orthoptera.d4=orthoptera.d4.2[orthoptera.d4.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(orthoptera.d4[,5:9], orthoptera.d4[,19:43])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(orthoptera.d4[,5:9],orthoptera.d4[,52:86])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(orthoptera.d4)
all.geog.dist=vegdist(orthoptera.d4[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(orthoptera.d4,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(orthoptera.d4,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:125])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(orthoptera.d4[,5:9]~orthoptera.d4$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
orthoptera.d4=orthoptera.d4.2[orthoptera.d4.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(orthoptera.d4[,5:9], orthoptera.d4[,19:43])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(orthoptera.d4[,5:9],orthoptera.d4[,c(52:86)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(orthoptera.d4)
all.geog.dist=vegdist(orthoptera.d4[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(orthoptera.d4,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(orthoptera.d4,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:112])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

## no variance partitioning needed because no significance/soil effect.

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(orthoptera.d4[,5:9]~orthoptera.d4$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

#### Colembola ####
collembola.d4=date4[,c(1:4,173:205,206:283)]
#remove NAs.
collembola.d4=na.omit(collembola.d4)
#save a back-up for later, just in case.
collembola.d4.2=collembola.d4
##rda by soil
colnames(collembola.d4)
hel.rda.fulsoil = rda(collembola.d4[,5:37], collembola.d4[,47:71])
anova(hel.rda.fulsoil)#AYO
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(collembola.d4[,5:37],collembola.d4[,c(80:113)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(collembola.d4)
all.geog.dist=vegdist(collembola.d4[,78:79],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(collembola.d4,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(collembola.d4,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:37], tree.hel.all.pcnm[,116:158])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(collembola.d4[,5:37]~collembola.d4$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

####CORE+EDGE####
collembola.d4=collembola.d4.2[collembola.d4.2$EP!="Trans",]
##rda by soil
hel.rda.fulsoil = rda(collembola.d4[,5:37], collembola.d4[,47:71])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(collembola.d4[,5:37],collembola.d4[,80:113])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(collembola.d4)
all.geog.dist=vegdist(collembola.d4[,78:79],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(collembola.d4,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(collembola.d4,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:37], tree.hel.all.pcnm[,116:153])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
## Variance partitioning - Not needed because there's no pcnm effect

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(collembola.d4[,5:37]~collembola.d4$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


####CORE PLOTS####
collembola.d4=collembola.d4.2[collembola.d4.2$EP=="Core",]
##rda by soil
hel.rda.fulsoil = rda(collembola.d4[,5:37], collembola.d4[,47:71])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by trees
hel.rda.fulsoil = rda(collembola.d4[,5:37],collembola.d4[,c(80:113)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Pitfall inverts by PCNM
colnames(collembola.d4)
all.geog.dist=vegdist(collembola.d4[,78:79],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(collembola.d4,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(collembola.d4,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:37], tree.hel.all.pcnm[,116:140])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

## no variance partitioning needed because no significance/soil effect.

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(collembola.d4[,5:37]~collembola.d4$TerrType)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared
```

```{r Diversity}
#Gamma diversity between ecosystems
rownames(date1)=date1[,1]
dim(date1)
Hdate1=diversity(date1[1:89,5:205])
raredate1=rarefy(date1[,5:205], 2)-1
specno=specnumber(date1[5:205], MARGIN=1)

botrich=lme(specno~as.factor(TerrType)*Date+Plot,random=~1, data=pitfall)
summary(botrich)
TukeyHSD(botrich)
shapiro.test(specscno)

#Alpha
alpha1=fisher.alpha(date1[,5:205])
alpha2=fisher.alpha(date2[,5:205])
alpha3=fisher.alpha(date3[,5:205])
alpha4=fisher.alpha(date4[,5:205])
boxplot(alpha1)
plot(alpha2)
plot(alpha3)
plot(alpha4)


#Gamma
gammadiv=with(date1, tapply(specnumber(date1[,5:205]),TerrType))
plot(gammadiv)
gamma2=with(date2, tapply(specnumber(date2[,5:205]),TerrType))
gamma3=with(date3, tapply(specnumber(date3[,5:205]),TerrType))
gamma4=with(date4, tapply(specnumber(date4[,5:205]),TerrType))
plot(gammadiv,gamma2,gamma3,gamma4)
#Beta
alpha1 <- with(date1, tapply(specnumber(date1[,5:205]), TerrType, mean))
alpha2 <- with(date2, tapply(specnumber(date2[,5:205]), TerrType, mean))
alpha3 <- with(date3, tapply(specnumber(date3[,5:205]), TerrType, mean))
alpha4 <- with(date4, tapply(specnumber(date4[,5:205]), TerrType, mean))
beta1=gammadiv/alpha1-1
beta2=gamma2/alpha2-1
beta3=gamma3/alpha3-1
beta4=gamma4/alpha4-1

boxplot(alpha1,alpha2,alpha3,alpha4, xlab="Date", ylab="Species Richness")
mtext(side=1,at=1,"26 Sept 2015",las=2,line=1, srt=45)
mtext(side=1,at=2,"24 May 2016",las=2,line=1)
mtext(side=1,at=3,"28 July 2018",las=2,line=1)
mtext(side=1,at=4,"15 Oct 2016",las=2,line=1)


##Real stats or something
colnames(date1)
dim(date1)
rownames(date1)=date1[,1]
Hdate1=diversity(date1[5:205], index="shannon")
rownames(date2)=date2[,1]
Hdate2=diversity(date2[5:205], index="shannon")
rownames(date3)=date3[,1]
Hdate3=diversity(date3[5:205], index="shannon")
rownames(date4)=date4[,1]
Hdate4=diversity(date4[5:205], index="shannon")
boxplot(Hdate1, Hdate2, Hdate3, Hdate4, xlab="Date", ylab="Shannon's Index")
mtext(side=1,at=1,"26 Sept 2015",las=2,line=1, srt=45)
mtext(side=1,at=2,"24 May 2016",las=2,line=1)
mtext(side=1,at=3,"28 July 2018",las=2,line=1)
mtext(side=1,at=4,"15 Oct 2016",las=2,line=1)


#shannon's diversity by ecosystem type
bot=pitfall[pitfall$TerrType=="B",]
rownames(bot)=bot[,1]
b1=bot[bot$Date=="9.26.15",]
b2=bot[bot$Date=="5.24.16",]
b3=bot[bot$Date=="7.28.16",]
b4=bot[bot$Date=="10.15.16",]
dim(bot)
Hbot=diversity(bot[5:205], index="shannon")
hb1=diversity(b1[5:205], index="shannon")
hb2=diversity(b2[5:205], index="shannon")
hb3=diversity(b3[5:205], index="shannon")
hb4=diversity(b4[5:205], index="shannon")
boxplot(Hbot,hb1, hb2, hb3, hb4, xlab="bottomland diversity", ylab="shannons diversity", ylim=c(1,3.5))
mtext(side=1,at=1,"All Dates",las=2,line=1, srt=45)
mtext(side=1,at=2,"26 Sept 2015",las=2,line=1, srt=45)
mtext(side=1,at=3,"24 May 2016",las=2,line=1)
mtext(side=1,at=4,"28 July 2018",las=2,line=1)
mtext(side=1,at=5,"15 Oct 2016",las=2,line=1)


srb1=specnumber(b1[5:205], MARGIN=1)
srb2=specnumber(b2[5:205], MARGIN=1)
srb3=specnumber(b3[5:205], MARGIN=1)
srb4=specnumber(b4[5:205], MARGIN=1)
boxplot(srb1,srb2,srb3,srb4, xlab="bottomland richness", ylab="species richness", ylim=c(0,40))
mtext(side=1,at=1,"26 Sept 2015",las=2,line=1, srt=45)
mtext(side=1,at=2,"24 May 2016",las=2,line=1)
mtext(side=1,at=3,"28 July 2016",las=2,line=1)
mtext(side=1,at=4,"15 Oct 2016",las=2,line=1)


rip=pitfall[pitfall$TerrType=="R",]
r1=rip[rip$Date=="9.26.15",]
r2=rip[rip$Date=="5.24.16",]
r3=rip[rip$Date=="7.28.16",]
r4=rip[rip$Date=="10.15.16",]
Hrip=diversity(rip[5:205], index="shannon")
hr1=diversity(r1[5:205], index="shannon")
hr2=diversity(r2[5:205], index="shannon")
hr3=diversity(r3[5:205], index="shannon")
hr4=diversity(r4[5:205], index="shannon")
boxplot(Hrip, hr1, hr2, hr3, hr4, xlab="riparian diversity", ylab="shannons diversity",ylim=c(1,3.5))
mtext(side=1,at=1,"All Dates",las=2,line=1, srt=45)
mtext(side=1,at=2,"26 Sept 2015",las=2,line=1, srt=45)
mtext(side=1,at=3,"24 May 2016",las=2,line=1)
mtext(side=1,at=4,"28 July 2018",las=2,line=1)
mtext(side=1,at=5,"15 Oct 2016",las=2,line=1)


srr1=specnumber(r1[5:205], MARGIN=1)
srr2=specnumber(r2[5:205], MARGIN=1)
srr3=specnumber(r3[5:205], MARGIN=1)
srr4=specnumber(r4[5:205], MARGIN=1)
boxplot(srr1,srr2,srr3,srr4, xlab="riparian richness", ylab="species richness", ylim=c(0,40))
mtext(side=1,at=1,"26 Sept 2015",las=2,line=1, srt=45)
mtext(side=1,at=2,"24 May 2016",las=2,line=1)
mtext(side=1,at=3,"28 July 2018",las=2,line=1)
mtext(side=1,at=4,"15 Oct 2016",las=2,line=1)


upl=pitfall[pitfall$TerrType=="U",]
u1=upl[upl$Date=="9.26.15",]
u2=upl[upl$Date=="5.24.16",]
u3=upl[upl$Date=="7.28.16",]
u4=upl[upl$Date=="10.15.16",]
Hupl=diversity(upl[5:205], index="shannon")
hu1=diversity(u1[5:205], index="shannon")
hu2=diversity(u2[5:205], index="shannon")
hu3=diversity(u3[5:205], index="shannon")
hu4=diversity(u4[5:205], index="shannon")
boxplot(Hupl,hu1, hu2, hu3, hu4, xlab="upland diversity", ylab="shannons diversity", ylim=c(1,3.5))
mtext(side=1,at=1,"All Dates",las=2,line=1, srt=45)
mtext(side=1,at=2,"26 Sept 2015",las=2,line=1, srt=45)
mtext(side=1,at=3,"24 May 2016",las=2,line=1)
mtext(side=1,at=4,"28 July 2018",las=2,line=1)
mtext(side=1,at=5,"15 Oct 2016",las=2,line=1)


sru1=specnumber(u1[5:205], MARGIN=1)
sru2=specnumber(u2[5:205], MARGIN=1)
sru3=specnumber(u3[5:205], MARGIN=1)
sru4=specnumber(u4[5:205], MARGIN=1)
boxplot(sru1,sru2,sru3,sru4, xlab="upland richness", ylab="species richness", ylim=c(0,40))
mtext(side=1,at=1,"26 Sept 2015",las=2,line=1, srt=45)
mtext(side=1,at=2,"24 May 2016",las=2,line=1)
mtext(side=1,at=3,"28 July 2018",las=2,line=1)
mtext(side=1,at=4,"15 Oct 2016",las=2,line=1)


dis=pitfall[pitfall$TerrType=="D",]
rownames(dis)=dis[,1]
Hdis=diversity(dis[5:205], index="shannon")

boxplot(Hbot, Hrip, Hupl, Hdis, xlab="Ecosystem", ylab="Shannon's Diversity")
mtext(side=1,at=1,"Bottomland",las=2,line=1, srt=45)
mtext(side=1,at=2,"Riparian",las=2,line=1)
mtext(side=1,at=3,"Upland",las=2,line=1)
mtext(side=1,at=4,"Disturbed",las=2,line=1)


halp=aov(Hbot~bot$Date+bot$Plot)
summary(halp)
TukeyHSD(halp)
halp=aov(Hrip~rip$Date+rip$Plot)
summary(halp)
halp=aov(Hupl~upl$Date+upl$Plot)
summary(halp)
halp=aov(Hdis~dis$Date+dis$Plot)
summary(halp)

##Ecotone Diversity and Richness
#uplbot
uplbot=pitfall[pitfall$TerrType=="UB"|pitfall$TerrType=="BU",]
dim(uplbot)
ub1=uplbot[uplbot$Date=="9.26.15",]
ub2=uplbot[uplbot$Date=="5.24.16",]
ub3=uplbot[uplbot$Date=="7.28.16",]
ub4=uplbot[uplbot$Date=="10.15.16",]

ubdall=diversity(uplbot[5:205], index="shannon")
ubd1=diversity(ub1[5:205], index="shannon")
ubd2=diversity(ub2[5:205], index="shannon")
ubd3=diversity(ub3[5:205], index="shannon")
ubd4=diversity(ub4[5:205], index="shannon")
boxplot(ubdall, ubd1, ubd2, ubd3, ubd4, xlab="ub diversity", ylab="shannons diversity", ylim=c(1,3.5))
mtext(side=1,at=1,"All Dates",las=2,line=1, srt=45)
mtext(side=1,at=2,"26 Sept 2015",las=2,line=1, srt=45)
mtext(side=1,at=3,"24 May 2016",las=2,line=1)
mtext(side=1,at=4,"28 July 2018",las=2,line=1)
mtext(side=1,at=5,"15 Oct 2016",las=2,line=1)

ubr1=specnumber(ub1[5:205], MARGIN=1)
ubr2=specnumber(ub2[5:205], MARGIN=1)
ubr3=specnumber(ub3[5:205], MARGIN=1)
ubr4=specnumber(ub4[5:205], MARGIN=1)
boxplot(ubr1,ubr2,ubr3,ubr4, xlab="UB spp richness", ylab="species richness", ylim=c(0,40))
mtext(side=1,at=1,"26 Sept 2015",las=2,line=1, srt=45)
mtext(side=1,at=2,"24 May 2016",las=2,line=1)
mtext(side=1,at=3,"28 July 2018",las=2,line=1)
mtext(side=1,at=4,"15 Oct 2016",las=2,line=1)

#ripbot
ripbot=pitfall[pitfall$TerrType=="RB"|pitfall$TerrType=="BR",]
dim(ripbot)
rb1=ripbot[ripbot$Date=="9.26.15",]
rb2=ripbot[ripbot$Date=="5.24.16",]
rb3=ripbot[ripbot$Date=="7.28.16",]
rb4=ripbot[ripbot$Date=="10.15.16",]

rbdall=diversity(ripbot[5:205], index="shannon")
rbd1=diversity(rb1[5:205], index="shannon")
rbd2=diversity(rb2[5:205], index="shannon")
rbd3=diversity(rb3[5:205], index="shannon")
rbd4=diversity(rb4[5:205], index="shannon")
boxplot(rbdall, rbd1, rbd2, rbd3, rbd4, xlab="RB diversity", ylab="shannons diversity", ylim=c(1,3.5))
mtext(side=1,at=1,"All Dates",las=2,line=1, srt=45)
mtext(side=1,at=2,"26 Sept 2015",las=2,line=1, srt=45)
mtext(side=1,at=3,"24 May 2016",las=2,line=1)
mtext(side=1,at=4,"28 July 2018",las=2,line=1)
mtext(side=1,at=5,"15 Oct 2016",las=2,line=1)

rbr1=specnumber(rb1[5:205], MARGIN=1)
rbr2=specnumber(rb2[5:205], MARGIN=1)
rbr3=specnumber(rb3[5:205], MARGIN=1)
rbr4=specnumber(rb4[5:205], MARGIN=1)
boxplot(rbr1,rbr2,rbr3,rbr4, xlab="RB spp richness", ylab="species richness", ylim=c(0,40))
mtext(side=1,at=1,"26 Sept 2015",las=2,line=1, srt=45)
mtext(side=1,at=2,"24 May 2016",las=2,line=1)
mtext(side=1,at=3,"28 July 2018",las=2,line=1)
mtext(side=1,at=4,"15 Oct 2016",las=2,line=1)

#uplrip
uplrip=pitfall[pitfall$TerrType=="UR"|pitfall$TerrType=="RU",]
dim(uplrip)
ur1=uplrip[uplrip$Date=="9.26.15",]
ur2=uplrip[uplrip$Date=="5.24.16",]
ur3=uplrip[uplrip$Date=="7.28.16",]
ur4=uplrip[uplrip$Date=="10.15.16",]

urdall=diversity(uplrip[5:205], index="shannon")
urd1=diversity(ur1[5:205], index="shannon")
urd2=diversity(ur2[5:205], index="shannon")
urd3=diversity(ur3[5:205], index="shannon")
urd4=diversity(ur4[5:205], index="shannon")
boxplot(urdall,urd1, urd2, urd3, urd4, xlab="ur diversity", ylab="shannons diversity", ylim=c(1,3.5))
mtext(side=1,at=1,"All Dates",las=2,line=1, srt=45)
mtext(side=1,at=2,"26 Sept 2015",las=2,line=1, srt=45)
mtext(side=1,at=3,"24 May 2016",las=2,line=1)
mtext(side=1,at=4,"28 July 2018",las=2,line=1)
mtext(side=1,at=5,"15 Oct 2016",las=2,line=1)


urr1=specnumber(ur1[5:205], MARGIN=1)
urr2=specnumber(ur2[5:205], MARGIN=1)
urr3=specnumber(ur3[5:205], MARGIN=1)
urr4=specnumber(ur4[5:205], MARGIN=1)
srripupl=boxplot(urr1, urr2, urr3, urr4, xlab="ur spp richness", ylab="species richness", ylim=c(0,40))
mtext(side=1,at=1,"26 Sept 2015",las=2,line=1, srt=45)
mtext(side=1,at=2,"24 May 2016",las=2,line=1)
mtext(side=1,at=3,"28 July 2018",las=2,line=1)
mtext(side=1,at=4,"15 Oct 2016",las=2,line=1)

boxplot(hu4, urd4, hr4, xlab="Ecosystem", ylab="Shannons diversity")
mtext(side=1,at=1,"U",las=2,line=1, srt=45)
mtext(side=1,at=2,"UR",las=2,line=1)
mtext(side=1,at=3,"R",las=2,line=1)

boxplot(sru4, urr4, srr4, xlab="Ecosystem", ylab="species richness")
mtext(side=1,at=1,"U",las=2,line=1, srt=45)
mtext(side=1,at=2,"UR",las=2,line=1)
mtext(side=1,at=3,"R",las=2,line=1)



####GRAHING FOR ESA
boxplot(hr1, hr2, hr3, hr4, ylab="Shannon's Diversity")
title(main = "Riparian")

boxplot(srr1,srr2,srr3,srr4, xlab="Date", ylab="Taxonomic Richness", ylim=c(5,25))
mtext(side=1,at=1,"26 Sept 2015",las=0,line=1, srt=45)
mtext(side=1,at=2,"24 May 2016",las=0,line=1)
mtext(side=1,at=3,"28 July 2018",las=0,line=1)
mtext(side=1,at=4,"15 Oct 2016",las=0,line=1)

boxplot(urd1, urd2, urd3, urd4, xlab="") #Ecotone Diversity
title(main="Riparian-Upland")


srripupl=boxplot(urr1, urr2, urr3, urr4, xlab="Date") #SR RipUpl
mtext(side=1,at=1,"26 Sept 2015",las=0,line=1, srt=45)
mtext(side=1,at=2,"24 May 2016",las=0,line=1)
mtext(side=1,at=3,"28 July 2018",las=0,line=1)
mtext(side=1,at=4,"15 Oct 2016",las=0,line=1)

boxplot(hu1, hu2, hu3, hu4, xlab="") #Upland Diversity
title(main="Upland")

boxplot(sru1,sru2,sru3,sru4, xlab="Date", main="Upland")
mtext(side=1,at=1,"26 Sept 2015",las=0,line=1, srt=45)
mtext(side=1,at=2,"24 May 2016",las=0,line=1)
mtext(side=1,at=3,"28 July 2018",las=0,line=1)
mtext(side=1,at=4,"15 Oct 2016",las=0,line=1)



###
pitfall.core=pitfall[pitfall$EP.x=="Core",]
dim(pitfall.core)
halldates=diversity(pitfall.core[,5:205], index="shannon")
alldates=lme(halldates~TerrType*Date, random = ~ 1|Plot, data=pitfall.core)
anova(alldates)

sralldates=specnumber(pitfall.core[5:205], MARGIN=1)
datesall=lme(sralldates~TerrType*Date, random=~1|Plot, data=pitfall.core)
anova(datesall)

pitfall.edge=pitfall[pitfall$EP.x!="Trans",]
pitfall.edge=pitfall.edge[pitfall.edge$TerrType!="UR",]
dim(pitfall.edge)

halldates1=diversity(pitfall.edge[5:205], index="shannon")
alldates1=lme(halldates1~TerrType*Date, random = ~ 1|Plot, data=pitfall.edge)
anova(alldates1)

sralldates1=specnumber(pitfall.edge[5:205], MARGIN=1)
datesall1=lme(sralldates1~TerrType*Date, random=~1|Plot, data=pitfall.edge)
anova(datesall1)
summary(datesall1)

pitfall.edge$TerrType
colnames(pitfall)
pitfall$TerrType


colnames(pitfall)=pitfall[1,]
lme(Hdate1~TerrType+Plot, data=date1)
```

```{r indval}
sppabun=pitfall[,c(1:205,242:244)]
cores=sppabun[sppabun$EP=="Core",]
#cores=cores[cores$Ecosystem!="S",]
##Remove species that don't have individuals in the core
colnames(cores)
cores=cores[,c(1:5,7:10,12:25,28:59,61:67,69,71:73,75:79,81:83,87:105,107:108,110,114,116,118:122,124:125,127,129:142,144,146:150,152:153,155,157:159,161:162,165:167,169,171,174:176,178:182,184:190,192:205,208)]

indvalsummary=indval(cores[,5:168], clustering=cores$TerrType)
summary(indvalsummary, p=0.05,type='short', digits=2, show=p, sort=FALSE)


###Let's try this again with the entire forest. For shits and giggs.
totalcomm=sppabun[,c(1:5,7:26,28:67,69,71:73,75:79,81:83,85:105,107:110,112,114,116,118:127,129:144,146:150,152:153,155,157:159,161:162,165:167,169,171,174:190,192:208)]
indvaltotal=indval(totalcomm[,5:180],clustering=sppabun$TerrType)
summary(indvaltotal, p=0.05,type='short', digits=2, show=p, sort=FALSE)

###One last time with reference to edges.
#subset the cores out.
edges=sppabun[sppabun$EP=="Edge"|sppabun$EP=="Trans",]
#remove species that aren't present
edges=edges[,c(1:4,7:20,22:26,28:32,34:37,39,42:46,48:60,62,64:67,69,71:73,75:79,81:82,85:105,107:109,112,116,118:120,122:127,131:138,140:144,147:150,152:153,155,157,159,161:162,166:167,169,174:190,192:208)]
#run the stats
indvalsummary=indval(edges[,5:160], clustering=edges$TerrType)
summary(indvalsummary, p=0.05,type='short', digits=2, show=p, sort=FALSE)
#This would suggest that CARCAR, TILAME, and ULMSP are specialists in reference to edges/transition plots.
```

```{r CCA; H1}
## Date 1
##Let's take out the TerrTypes that we don't test (like things that include D and thus don't have replicates)
date1.cca=date1[date1$TerrType=="B"|date1$TerrType=="RU"|date1$TerrType=="U"|date1$TerrType=="BU"|date1$TerrType=="UR"|date1$TerrType=="T-UR"|date1$TerrType=="UB"|date1$TerrType=="T-UB"|date1$TerrType=="R"|date1$TerrType=="RB"|date1$TerrType=="BR"|date1$TerrType=="T-RB",]

## the CCA
pit.cca.d1=cca(date1.cca[,5:205]~date1.cca$TerrType)
anova(pit.cca.d1)
plot(pit.cca.d1)

## Date 2
date2.cca=date2[date2$TerrType=="B"|date2$TerrType=="RU"|date2$TerrType=="U"|date2$TerrType=="BU"|date2$TerrType=="UR"|date2$TerrType=="T-UR"|date2$TerrType=="UB"|date2$TerrType=="T-UB"|date2$TerrType=="R"|date2$TerrType=="RB"|date2$TerrType=="BR"|date2$TerrType=="T-RB",]

pit.cca.d2=cca(date2.cca[,5:205]~date2.cca$TerrType)
anova(pit.cca.d2)
plot(pit.cca.d2)

## Date 3
date3.cca=date3[date3$TerrType=="B"|date3$TerrType=="RU"|date3$TerrType=="U"|date3$TerrType=="BU"|date3$TerrType=="UR"|date3$TerrType=="T-UR"|date3$TerrType=="UB"|date3$TerrType=="T-UB"|date3$TerrType=="R"|date3$TerrType=="RB"|date3$TerrType=="BR"|date3$TerrType=="T-RB",]
pit.cca.d3=cca(date3.cca[,5:205]~date3.cca$TerrType)
anova(pit.cca.d3)
plot(pit.cca.d3)
scores(pit.cca.d3)

## Date 4
date4.cca=date4[date4$TerrType=="B"|date4$TerrType=="RU"|date4$TerrType=="U"|date4$TerrType=="BU"|date4$TerrType=="UR"|date4$TerrType=="T-UR"|date4$TerrType=="UB"|date4$TerrType=="T-UB"|date4$TerrType=="R"|date4$TerrType=="RB"|date4$TerrType=="BR"|date4$TerrType=="T-RB",]
pit.cca.d4=cca(date4.cca[,5:205]~date4.cca$TerrType)
anova(pit.cca.d4)
plot(pit.cca.d4)
```
```{r NMDS}
##Subset the dataset to remove plots and columns we don't need.
pitfall.data.nmds=pitfall[,1:212]
pitfall.data.nmds=pitfall.data.nmds[pitfall.data.nmds$TerrType=="B"|pitfall.data.nmds$TerrType=="R"|pitfall.data.nmds$TerrType=="U"|pitfall.data.nmds$TerrType=="BU"|pitfall.data.nmds$TerrType=="UB"|pitfall.data.nmds$TerrType=="RU"|pitfall.data.nmds$TerrType=="UR"|pitfall.data.nmds$TerrType=="BR"|pitfall.data.nmds$TerrType=="RB",]
pitfall.groups=c(pitfall$TerrType,pitfall[,5:205])

## Set up distance matrix
pitfall.rel.abun=decostand(pitfall.data.nmds[,5:205], method="total",labels=T)
pitfall.distance=vegdist(pitfall.rel.abun, method="bray",labels=T)
pitfall.dist.mat=as.matrix(pitfall.distance, labels= T)

##NMDS
pitfall.nmds=metaMDS(pitfall.dist.mat, 
                     distance="bray", 
                     k=3, 
                     maxit=999, 
                     trymax=500, 
                     wascores=TRUE)
goodness(pitfall.nmds)
stressplot(pitfall.nmds)

##Plot
plot(pitfall.nmds, "sites")
orditorp(pitfall.nmds, "sites")

##Let's jazz up this plot a little bit.
colvec<-c("gray0","red1","cornflowerblue","lightcyan3","tomato3","blueviolet")

plot(pitfall.nmds)
with(pitfall.groups,
     points(pitfall.nmds,
            display="sites",
            col="black",
            bg=colvec[TerrType]))
```

```{r Functional Feeding Groups DATE1}
### USING THE CODE FOR SPLITTING TAXONOMIC GROUPS. data.agg will ONLY fit what we specify in the other code. NOTES CAN BE FOUND AT THE END OF THE CODE FOR EACH GROUP

#### All plots
tree.hel.soil=merge(date1.agg,soildata,by="Plot")
tree.hel.soil=merge(tree.hel.soil, tree.hel, by="Plot")

rownames(tree.hel.soil)=tree.hel.soil[,1]
tree.hel.soil=na.exclude(tree.hel.soil)
# Here is the global analysis. Can proceed  Use adj. R square as additional stopping criterion.
colnames(tree.hel.soil)
dim(tree.hel.soil)

hel.rda.fulsoil = rda(tree.hel.soil[,5:9], tree.hel.soil[,19:43])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

###INVERT BY TREE DATA
hel.rda.fulsoil = rda(tree.hel.soil[,5:9],tree.hel.soil[,c(52:86)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

###INVERTS BY PCMN
#to determine spatial autocorrelation
# First we perform PCNM to get the vectors
colnames(tree.hel.soil)
all.geog.dist=vegdist(tree.hel.soil[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(tree.hel.soil,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(tree.hel.soil,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:129])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
# now run step 2, the selection part

#forward selection for our PCNM variables
hel.rda.all.pcnm.none=rda(tree.hel.all.pcnm[,5:9]~1)
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:129])

hel.rda.all.pcnm.full=rda(tree.hel.all.pcnm[,5:9]~tree.hel.all.pcnm$PCNM1+tree.hel.all.pcnm$PCNM2+tree.hel.all.pcnm$PCNM3+tree.hel.all.pcnm$PCNM4+tree.hel.all.pcnm$PCNM5+tree.hel.all.pcnm$PCNM6+tree.hel.all.pcnm$PCNM7+tree.hel.all.pcnm$PCNM8+tree.hel.all.pcnm$PCNM9+tree.hel.all.pcnm$PCNM10+tree.hel.all.pcnm$PCNM11+tree.hel.all.pcnm$PCNM12+tree.hel.all.pcnm$PCNM13+tree.hel.all.pcnm$PCNM14+tree.hel.all.pcnm$PCNM15+tree.hel.all.pcnm$PCNM16+tree.hel.all.pcnm$PCNM17+tree.hel.all.pcnm$PCNM18+tree.hel.all.pcnm$PCNM19+tree.hel.all.pcnm$PCNM20+tree.hel.all.pcnm$PCNM21+tree.hel.all.pcnm$PCNM22+tree.hel.all.pcnm$PCNM23+tree.hel.all.pcnm$PCNM24+tree.hel.all.pcnm$PCNM25+tree.hel.all.pcnm$PCNM26+tree.hel.all.pcnm$PCNM27+tree.hel.all.pcnm$PCNM28+tree.hel.all.pcnm$PCNM29+tree.hel.all.pcnm$PCNM30+tree.hel.all.pcnm$PCNM31+tree.hel.all.pcnm$PCNM32+tree.hel.all.pcnm$PCNM33+tree.hel.all.pcnm$PCNM34+tree.hel.all.pcnm$PCNM35+tree.hel.all.pcnm$PCNM36+tree.hel.all.pcnm$PCNM37+tree.hel.all.pcnm$PCNM38+tree.hel.all.pcnm$PCNM39+tree.hel.all.pcnm$PCNM40+tree.hel.all.pcnm$PCNM41+tree.hel.all.pcnm$PCNM42)

tree.sel=ordiR2step(hel.rda.all.pcnm.none,scope=formula(hel.rda.all.pcnm.full),Pin=0.05,R2scope=TRUE)
tree.sel

##Just the variables forward selected
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,c(93,89,124,91,127,111,98,115)])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(tree.hel.soil[,5:9]~tree.hel.soil$ecosys)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

#### CORE+EDGE ####
tree.hel.soil=tree.hel.soil[tree.hel.soil$EP=="Core"|tree.hel.soil$EP=="Edge",]
dim(tree.hel.soil)
rownames(tree.hel.soil)=tree.hel.soil[,1]
tree.hel.soil=na.exclude(tree.hel.soil)
# Here is the global analysis. Can proceed  Use adj. R square as additional stopping criterion.
colnames(tree.hel.soil)

hel.rda.fulsoil = rda(tree.hel.soil[,5:9], tree.hel.soil[,19:43])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

###INVERT BY TREE DATA
hel.rda.fulsoil = rda(tree.hel.soil[,5:9],tree.hel.soil[,c(52:86)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

###INVERTS BY PCMN
#to determine spatial autocorrelation
# First we perform PCNM to get the vectors
colnames(tree.hel.soil)
all.geog.dist=vegdist(tree.hel.soil[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(tree.hel.soil,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(tree.hel.soil,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:124])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

#forward selection for our PCNM variables
hel.rda.all.pcnm.none=rda(tree.hel.all.pcnm[,5:9]~1)
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:124])

hel.rda.all.pcnm.full=rda(tree.hel.all.pcnm[,5:9]~tree.hel.all.pcnm$PCNM1+tree.hel.all.pcnm$PCNM2+tree.hel.all.pcnm$PCNM3+tree.hel.all.pcnm$PCNM4+tree.hel.all.pcnm$PCNM5+tree.hel.all.pcnm$PCNM6+tree.hel.all.pcnm$PCNM7+tree.hel.all.pcnm$PCNM8+tree.hel.all.pcnm$PCNM9+tree.hel.all.pcnm$PCNM10+tree.hel.all.pcnm$PCNM11+tree.hel.all.pcnm$PCNM12+tree.hel.all.pcnm$PCNM13+tree.hel.all.pcnm$PCNM14+tree.hel.all.pcnm$PCNM15+tree.hel.all.pcnm$PCNM16+tree.hel.all.pcnm$PCNM17+tree.hel.all.pcnm$PCNM18+tree.hel.all.pcnm$PCNM19+tree.hel.all.pcnm$PCNM20+tree.hel.all.pcnm$PCNM21+tree.hel.all.pcnm$PCNM22+tree.hel.all.pcnm$PCNM23+tree.hel.all.pcnm$PCNM24+tree.hel.all.pcnm$PCNM25+tree.hel.all.pcnm$PCNM26+tree.hel.all.pcnm$PCNM27+tree.hel.all.pcnm$PCNM28+tree.hel.all.pcnm$PCNM29+tree.hel.all.pcnm$PCNM30+tree.hel.all.pcnm$PCNM31+tree.hel.all.pcnm$PCNM32+tree.hel.all.pcnm$PCNM33+tree.hel.all.pcnm$PCNM34+tree.hel.all.pcnm$PCNM35+tree.hel.all.pcnm$PCNM36+tree.hel.all.pcnm$PCNM37)

tree.sel=ordiR2step(hel.rda.all.pcnm.none,scope=formula(hel.rda.all.pcnm.full),Pin=0.05,R2scope=TRUE)
tree.sel

##Just the variables forward selected
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,c(90,118,122,120,108,88)])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(tree.hel.soil[,5:9]~tree.hel.soil$ecosys)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

#### Core plots ####
tree.hel.soil=tree.hel.soil[tree.hel.soil$EP=="Core",]
dim(tree.hel.soil)
rownames(tree.hel.soil)=tree.hel.soil[,1]
tree.hel.soil=na.exclude(tree.hel.soil)
# Here is the global analysis. Can proceed  Use adj. R square as additional stopping criterion.
colnames(tree.hel.soil)
dim(tree.hel.soil)

hel.rda.fulsoil = rda(tree.hel.soil[,5:9], tree.hel.soil[,19:43])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

###INVERT BY TREE DATA
hel.rda.fulsoil = rda(tree.hel.soil[,5:9],tree.hel.soil[,c(52:86)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

###INVERTS BY PCMN
#to determine spatial autocorrelation
# First we perform PCNM to get the vectors
colnames(tree.hel.soil)
all.geog.dist=vegdist(tree.hel.soil[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(tree.hel.soil,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(tree.hel.soil,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:111])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
# now run step 2, the selection part

#forward selection for our PCNM variables
hel.rda.all.pcnm.none=rda(tree.hel.all.pcnm[,5:9]~1)
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:111])

hel.rda.all.pcnm.full=rda(tree.hel.all.pcnm[,5:9]~tree.hel.all.pcnm$PCNM1+tree.hel.all.pcnm$PCNM2+tree.hel.all.pcnm$PCNM3+tree.hel.all.pcnm$PCNM4+tree.hel.all.pcnm$PCNM5+tree.hel.all.pcnm$PCNM6+tree.hel.all.pcnm$PCNM7+tree.hel.all.pcnm$PCNM8+tree.hel.all.pcnm$PCNM9+tree.hel.all.pcnm$PCNM10+tree.hel.all.pcnm$PCNM11+tree.hel.all.pcnm$PCNM12+tree.hel.all.pcnm$PCNM13+tree.hel.all.pcnm$PCNM14+tree.hel.all.pcnm$PCNM15+tree.hel.all.pcnm$PCNM16+tree.hel.all.pcnm$PCNM17+tree.hel.all.pcnm$PCNM18+tree.hel.all.pcnm$PCNM19+tree.hel.all.pcnm$PCNM20+tree.hel.all.pcnm$PCNM21+tree.hel.all.pcnm$PCNM22+tree.hel.all.pcnm$PCNM23+tree.hel.all.pcnm$PCNM24)

tree.sel=ordiR2step(hel.rda.all.pcnm.none,scope=formula(hel.rda.all.pcnm.full),Pin=0.05,R2scope=TRUE)
tree.sel

##Just the variables forward selected
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,c(105,107,88,89,109,90,95)])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(tree.hel.soil[,5:9]~tree.hel.soil$ecosys)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared
```
```{r Functional Feeding Groups DATE2}
### USING THE CODE FOR SPLITTING TAXONOMIC GROUPS. data.agg will ONLY fit what we specify in the other code. NOTES CAN BE FOUND AT THE END OF THE CODE FOR EACH GROUP

#### All plots
tree.hel.soil=merge(date2.agg,soildata,by="Plot")
tree.hel.soil=merge(tree.hel.soil, tree.hel, by="Plot")

rownames(tree.hel.soil)=tree.hel.soil[,1]
tree.hel.soil=na.exclude(tree.hel.soil)
# Here is the global analysis. Can proceed  Use adj. R square as additional stopping criterion.
colnames(tree.hel.soil)
dim(tree.hel.soil)

hel.rda.fulsoil = rda(tree.hel.soil[,5:9], tree.hel.soil[,19:43])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

###INVERT BY TREE DATA
hel.rda.fulsoil = rda(tree.hel.soil[,5:9],tree.hel.soil[,c(52:86)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Forward selection
hel.rda.fulsoil.none = rda(tree.hel.soil[,5:9]~1)
hel.rda.fulsoil = rda(tree.hel.soil[,5:9], tree.hel.soil[,52:86])

hel.rda.fulsoil.full=rda(tree.hel.soil[,5:9]~tree.hel.soil$ACERUB+tree.hel.soil$ACESAC+tree.hel.soil$ACESIL+tree.hel.soil$BETALL+tree.hel.soil$CARCAR+tree.hel.soil$CARCOR+tree.hel.soil$CAROVA+tree.hel.soil$CARTOM+tree.hel.soil$CORFLO+tree.hel.soil$CRAPUN+tree.hel.soil$FAGAME+tree.hel.soil$FRAAME+tree.hel.soil$FRANIG+tree.hel.soil$HAMVIR+tree.hel.soil$LIRTUP+tree.hel.soil$MAGACU+tree.hel.soil$MALCOR+tree.hel.soil$NYSSYL+tree.hel.soil$OSTVIR+tree.hel.soil$PLAOCC+tree.hel.soil$POPDEL+tree.hel.soil$POPGRA+tree.hel.soil$PRUSER+tree.hel.soil$QUEALB+tree.hel.soil$QUERUB+tree.hel.soil$SALNIG+tree.hel.soil$SASALB+tree.hel.soil$TILAME+tree.hel.soil$TOXVER+tree.hel.soil$ULMAME+tree.hel.soil$ULMRUB+tree.hel.soil$ULMSP+tree.hel.soil$VIBLEN)

tree.sel=ordiR2step(hel.rda.fulsoil.none,scope=formula(hel.rda.fulsoil.full),Pin=0.05,R2scope=TRUE)
tree.sel

##Just the variables forward selected
hel.rda.fulsoil = rda(tree.hel.soil[,5:9], tree.hel.soil[,c(172,176)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


###INVERTS BY PCMN
#to determine spatial autocorrelation
# First we perform PCNM to get the vectors
colnames(tree.hel.soil)
all.geog.dist=vegdist(tree.hel.soil[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(tree.hel.soil,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(tree.hel.soil,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,98:135])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
# now run step 2, the selection part

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(tree.hel.soil[,5:9]~tree.hel.soil$ecosys)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

#### CORE+EDGE ####
tree.hel.soil=tree.hel.soil[tree.hel.soil$EP=="Core"|tree.hel.soil$EP=="Edge",]
dim(tree.hel.soil)
rownames(tree.hel.soil)=tree.hel.soil[,1]
tree.hel.soil=na.exclude(tree.hel.soil)
# Here is the global analysis. Can proceed  Use adj. R square as additional stopping criterion.
colnames(tree.hel.soil)

hel.rda.fulsoil = rda(tree.hel.soil[,5:9], tree.hel.soil[,19:43])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

###INVERT BY TREE DATA
hel.rda.fulsoil = rda(tree.hel.soil[,5:9],tree.hel.soil[,c(52:86)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Forward selection
hel.rda.fulsoil.none = rda(tree.hel.soil[,5:9]~1)
hel.rda.fulsoil = rda(tree.hel.soil[,5:9], tree.hel.soil[,52:86])

hel.rda.fulsoil.full=rda(tree.hel.soil[,5:9]~tree.hel.soil$ACERUB+tree.hel.soil$ACESAC+tree.hel.soil$ACESIL+tree.hel.soil$BETALL+tree.hel.soil$CARCAR+tree.hel.soil$CARCOR+tree.hel.soil$CAROVA+tree.hel.soil$CARTOM+tree.hel.soil$CORFLO+tree.hel.soil$CRAPUN+tree.hel.soil$FAGAME+tree.hel.soil$FRAAME+tree.hel.soil$FRANIG+tree.hel.soil$HAMVIR+tree.hel.soil$LIRTUP+tree.hel.soil$MAGACU+tree.hel.soil$MALCOR+tree.hel.soil$NYSSYL+tree.hel.soil$OSTVIR+tree.hel.soil$PLAOCC+tree.hel.soil$POPDEL+tree.hel.soil$POPGRA+tree.hel.soil$PRUSER+tree.hel.soil$QUEALB+tree.hel.soil$QUERUB+tree.hel.soil$SALNIG+tree.hel.soil$SASALB+tree.hel.soil$TILAME+tree.hel.soil$TOXVER+tree.hel.soil$ULMAME+tree.hel.soil$ULMRUB+tree.hel.soil$ULMSP+tree.hel.soil$VIBLEN)

tree.sel=ordiR2step(hel.rda.fulsoil.none,scope=formula(hel.rda.fulsoil.full),Pin=0.05,R2scope=TRUE)
tree.sel

##Just the variables forward selected
hel.rda.fulsoil = rda(tree.hel.soil[,5:9], tree.hel.soil[,c(172,176)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


###INVERTS BY PCMN
#to determine spatial autocorrelation
# First we perform PCNM to get the vectors
colnames(tree.hel.soil)
all.geog.dist=vegdist(tree.hel.soil[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(tree.hel.soil,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(tree.hel.soil,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[88:123])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(tree.hel.soil[,5:9]~tree.hel.soil$ecosys)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

#### Core plots ####
tree.hel.soil=tree.hel.soil[tree.hel.soil$EP=="Core",]
dim(tree.hel.soil)
rownames(tree.hel.soil)=tree.hel.soil[,1]
tree.hel.soil=na.exclude(tree.hel.soil)
# Here is the global analysis. Can proceed  Use adj. R square as additional stopping criterion.
colnames(tree.hel.soil)
dim(tree.hel.soil)

hel.rda.fulsoil = rda(tree.hel.soil[,5:9], tree.hel.soil[,19:43])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

###INVERT BY TREE DATA
hel.rda.fulsoil = rda(tree.hel.soil[,5:9],tree.hel.soil[,c(52:86)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

##Forward selection
hel.rda.fulsoil.none = rda(tree.hel.soil[,5:9]~1)
hel.rda.fulsoil = rda(tree.hel.soil[,5:9], tree.hel.soil[,52:86])

hel.rda.fulsoil.full=rda(tree.hel.soil[,5:9]~tree.hel.soil$ACERUB+tree.hel.soil$ACESAC+tree.hel.soil$ACESIL+tree.hel.soil$BETALL+tree.hel.soil$CARCAR+tree.hel.soil$CARCOR+tree.hel.soil$CAROVA+tree.hel.soil$CARTOM+tree.hel.soil$CORFLO+tree.hel.soil$CRAPUN+tree.hel.soil$FAGAME+tree.hel.soil$FRAAME+tree.hel.soil$FRANIG+tree.hel.soil$HAMVIR+tree.hel.soil$LIRTUP+tree.hel.soil$MAGACU+tree.hel.soil$MALCOR+tree.hel.soil$NYSSYL+tree.hel.soil$OSTVIR+tree.hel.soil$PLAOCC+tree.hel.soil$POPDEL+tree.hel.soil$POPGRA+tree.hel.soil$PRUSER+tree.hel.soil$QUEALB+tree.hel.soil$QUERUB+tree.hel.soil$SALNIG+tree.hel.soil$SASALB+tree.hel.soil$TILAME+tree.hel.soil$TOXVER+tree.hel.soil$ULMAME+tree.hel.soil$ULMRUB+tree.hel.soil$ULMSP+tree.hel.soil$VIBLEN)

tree.sel=ordiR2step(hel.rda.fulsoil.none,scope=formula(hel.rda.fulsoil.full),Pin=0.05,R2scope=TRUE)
tree.sel

##Just the variables forward selected
hel.rda.fulsoil = rda(tree.hel.soil[,5:9], tree.hel.soil[,c(172,176)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared


###INVERTS BY PCMN
#to determine spatial autocorrelation
# First we perform PCNM to get the vectors
colnames(tree.hel.soil)
all.geog.dist=vegdist(tree.hel.soil[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(tree.hel.soil,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(tree.hel.soil,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,98:119])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
# now run step 2, the selection part

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(tree.hel.soil[,5:9]~tree.hel.soil$ecosys)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared
```
```{r Functional Feeding Groups DATE3}
### USING THE CODE FOR SPLITTING TAXONOMIC GROUPS. data.agg will ONLY fit what we specify in the other code. NOTES CAN BE FOUND AT THE END OF THE CODE FOR EACH GROUP

#### All plots
tree.hel.soil=merge(date3.agg,soildata,by="Plot")
tree.hel.soil=merge(tree.hel.soil, tree.hel, by="Plot")

rownames(tree.hel.soil)=tree.hel.soil[,1]
tree.hel.soil=na.exclude(tree.hel.soil)
# Here is the global analysis. Can proceed  Use adj. R square as additional stopping criterion.
colnames(tree.hel.soil)
dim(tree.hel.soil)

hel.rda.fulsoil = rda(tree.hel.soil[,5:9], tree.hel.soil[,19:43])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

###INVERT BY TREE DATA
hel.rda.fulsoil = rda(tree.hel.soil[,5:9],tree.hel.soil[,c(52:86)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

###INVERTS BY PCMN
#to determine spatial autocorrelation
# First we perform PCNM to get the vectors
colnames(tree.hel.soil)
all.geog.dist=vegdist(tree.hel.soil[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(tree.hel.soil,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(tree.hel.soil,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:131])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
# now run step 2, the selection part

#forward selection for our PCNM variables
hel.rda.all.pcnm.none=rda(tree.hel.all.pcnm[,5:9]~1)
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:131])

hel.rda.all.pcnm.full=rda(tree.hel.all.pcnm[,5:9]~tree.hel.all.pcnm$PCNM1+tree.hel.all.pcnm$PCNM2+tree.hel.all.pcnm$PCNM3+tree.hel.all.pcnm$PCNM4+tree.hel.all.pcnm$PCNM5+tree.hel.all.pcnm$PCNM6+tree.hel.all.pcnm$PCNM7+tree.hel.all.pcnm$PCNM8+tree.hel.all.pcnm$PCNM9+tree.hel.all.pcnm$PCNM10+tree.hel.all.pcnm$PCNM11+tree.hel.all.pcnm$PCNM12+tree.hel.all.pcnm$PCNM13+tree.hel.all.pcnm$PCNM14+tree.hel.all.pcnm$PCNM15+tree.hel.all.pcnm$PCNM16+tree.hel.all.pcnm$PCNM17+tree.hel.all.pcnm$PCNM18+tree.hel.all.pcnm$PCNM19+tree.hel.all.pcnm$PCNM20+tree.hel.all.pcnm$PCNM21+tree.hel.all.pcnm$PCNM22+tree.hel.all.pcnm$PCNM23+tree.hel.all.pcnm$PCNM24+tree.hel.all.pcnm$PCNM25+tree.hel.all.pcnm$PCNM26+tree.hel.all.pcnm$PCNM27+tree.hel.all.pcnm$PCNM28+tree.hel.all.pcnm$PCNM29+tree.hel.all.pcnm$PCNM30+tree.hel.all.pcnm$PCNM31+tree.hel.all.pcnm$PCNM32+tree.hel.all.pcnm$PCNM33+tree.hel.all.pcnm$PCNM34+tree.hel.all.pcnm$PCNM35+tree.hel.all.pcnm$PCNM36+tree.hel.all.pcnm$PCNM37+tree.hel.all.pcnm$PCNM38+tree.hel.all.pcnm$PCNM39+tree.hel.all.pcnm$PCNM40+tree.hel.all.pcnm$PCNM41+tree.hel.all.pcnm$PCNM42+tree.hel.all.pcnm$PCNM43+tree.hel.all.pcnm$PCNM44)

tree.sel=ordiR2step(hel.rda.all.pcnm.none,scope=formula(hel.rda.all.pcnm.full),Pin=0.05,R2scope=TRUE)
tree.sel

##Just the variables forward selected
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,c(88:90,95,115:116,103)])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(tree.hel.soil[,5:9]~tree.hel.soil$ecosys)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

#### CORE+EDGE ####
tree.hel.soil=tree.hel.soil[tree.hel.soil$EP=="Core"|tree.hel.soil$EP=="Edge",]
dim(tree.hel.soil)
rownames(tree.hel.soil)=tree.hel.soil[,1]
tree.hel.soil=na.exclude(tree.hel.soil)
# Here is the global analysis. Can proceed  Use adj. R square as additional stopping criterion.
colnames(tree.hel.soil)

hel.rda.fulsoil = rda(tree.hel.soil[,5:9], tree.hel.soil[,19:43])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

###INVERT BY TREE DATA
hel.rda.fulsoil = rda(tree.hel.soil[,5:9],tree.hel.soil[,c(52:86)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

###INVERTS BY PCMN
#to determine spatial autocorrelation
# First we perform PCNM to get the vectors
colnames(tree.hel.soil)
all.geog.dist=vegdist(tree.hel.soil[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(tree.hel.soil,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(tree.hel.soil,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:125])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(tree.hel.soil[,5:9]~tree.hel.soil$ecosys)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

#### Core plots ####
tree.hel.soil=tree.hel.soil[tree.hel.soil$EP=="Core",]
dim(tree.hel.soil)
rownames(tree.hel.soil)=tree.hel.soil[,1]
tree.hel.soil=na.exclude(tree.hel.soil)
# Here is the global analysis. Can proceed  Use adj. R square as additional stopping criterion.
colnames(tree.hel.soil)
dim(tree.hel.soil)

hel.rda.fulsoil = rda(tree.hel.soil[,5:9], tree.hel.soil[,19:43])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

###INVERT BY TREE DATA
hel.rda.fulsoil = rda(tree.hel.soil[,5:9],tree.hel.soil[,c(52:86)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

###INVERTS BY PCMN
#to determine spatial autocorrelation
# First we perform PCNM to get the vectors
colnames(tree.hel.soil)
all.geog.dist=vegdist(tree.hel.soil[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(tree.hel.soil,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(tree.hel.soil,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:112])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
# now run step 2, the selection part

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(tree.hel.soil[,5:9]~tree.hel.soil$ecosys)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared
```
```{r Functional Feeding Groups DATE4}
### USING THE CODE FOR SPLITTING TAXONOMIC GROUPS. data.agg will ONLY fit what we specify in the other code. NOTES CAN BE FOUND AT THE END OF THE CODE FOR EACH GROUP

#### All plots
tree.hel.soil=merge(date4.agg,soildata,by="Plot")
tree.hel.soil=merge(tree.hel.soil, tree.hel, by="Plot")

rownames(tree.hel.soil)=tree.hel.soil[,1]
tree.hel.soil=na.exclude(tree.hel.soil)
# Here is the global analysis. Can proceed  Use adj. R square as additional stopping criterion.
colnames(tree.hel.soil)
dim(tree.hel.soil)

hel.rda.fulsoil = rda(tree.hel.soil[,5:9], tree.hel.soil[,19:43])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

###INVERT BY TREE DATA
hel.rda.fulsoil = rda(tree.hel.soil[,5:9],tree.hel.soil[,c(52:86)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

###INVERTS BY PCMN
#to determine spatial autocorrelation
# First we perform PCNM to get the vectors
colnames(tree.hel.soil)
all.geog.dist=vegdist(tree.hel.soil[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(tree.hel.soil,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(tree.hel.soil,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:130])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
# now run step 2, the selection part

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(tree.hel.soil[,5:9]~tree.hel.soil$ecosys)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

#### CORE+EDGE ####
tree.hel.soil=tree.hel.soil[tree.hel.soil$EP=="Core"|tree.hel.soil$EP=="Edge",]
dim(tree.hel.soil)
rownames(tree.hel.soil)=tree.hel.soil[,1]
tree.hel.soil=na.exclude(tree.hel.soil)
# Here is the global analysis. Can proceed  Use adj. R square as additional stopping criterion.
colnames(tree.hel.soil)

hel.rda.fulsoil = rda(tree.hel.soil[,5:9], tree.hel.soil[,19:43])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

###INVERT BY TREE DATA
hel.rda.fulsoil = rda(tree.hel.soil[,5:9],tree.hel.soil[,c(52:86)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

###INVERTS BY PCMN
#to determine spatial autocorrelation
# First we perform PCNM to get the vectors
colnames(tree.hel.soil)
all.geog.dist=vegdist(tree.hel.soil[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(tree.hel.soil,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(tree.hel.soil,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[88:125])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(tree.hel.soil[,5:9]~tree.hel.soil$ecosys)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

#### Core plots ####
tree.hel.soil=tree.hel.soil[tree.hel.soil$EP=="Core",]
dim(tree.hel.soil)
rownames(tree.hel.soil)=tree.hel.soil[,1]
tree.hel.soil=na.exclude(tree.hel.soil)
# Here is the global analysis. Can proceed  Use adj. R square as additional stopping criterion.
colnames(tree.hel.soil)
dim(tree.hel.soil)

hel.rda.fulsoil = rda(tree.hel.soil[,5:9], tree.hel.soil[,19:43])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

###INVERT BY TREE DATA
hel.rda.fulsoil = rda(tree.hel.soil[,5:9],tree.hel.soil[,c(52:86)])
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared

###INVERTS BY PCMN
#to determine spatial autocorrelation
# First we perform PCNM to get the vectors
colnames(tree.hel.soil)
all.geog.dist=vegdist(tree.hel.soil[,50:51],method="euclid")
all.pcnm1=pcnm(all.geog.dist)
all.pcnmvecs=all.pcnm1$vectors
# If you can get the PCNM library to run, you could do the line below to select only significantly structured PCNMs
#tree.hel.all.pcnm=cbind(tree.hel.soil,all.pcnmvecs[,which(all.pcnm1$Moran_I[,2]<0.05)])
tree.hel.all.pcnm=cbind(tree.hel.soil,all.pcnmvecs)
names(tree.hel.all.pcnm)
# Now run step 1, global analysis
hel.rda.all.fulpcnm=rda(tree.hel.all.pcnm[,5:9], tree.hel.all.pcnm[,88:112])
anova(hel.rda.all.fulpcnm)
RsquareAdj(hel.rda.all.fulpcnm)
global.thresh=RsquareAdj(hel.rda.all.fulpcnm)$adj.r.squared
# now run step 2, the selection part

##INVERTS BY ECOSYSTEM
hel.rda.fulsoil = rda(tree.hel.soil[,5:9]~tree.hel.soil$ecosys)
anova(hel.rda.fulsoil)
RsquareAdj(hel.rda.fulsoil)
global.thresh=RsquareAdj(hel.rda.fulsoil)$adj.r.squared
```